(()=>{const e="smarvy-area-card",t=`${e}-editor`,n=(e,t,n)=>Math.max(t,Math.min(n,e)),i=e=>e?String(e).split(".")[0]:"",o=(e,t)=>e?.states?.[t]??null,r=(e,t,n={})=>{e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0}))},s=e=>{const t=i(e);return"light"===t?"mdi:lightbulb":"switch"===t?"mdi:power-socket-de":"fan"===t?"mdi:fan":"input_boolean"===t?"mdi:toggle-switch":"cover"===t?"mdi:window-shutter":"mdi:flash"},a=(e,t)=>{const n=o(e,t);return n?.attributes?.friendly_name||t||""},l=(e,{keepEmptyButtons:t=!1}={})=>{const i={...e||{}};return i.name=i.name??"",i.icon=i.icon??"mdi:home",i.temp_entity=i.temp_entity??"",i.humidity_entity=i.humidity_entity??"",i.window_entity=(i.window_entity??"").trim(),i.nav_path=(i.nav_path??"").trim(),i.cover_invert=!!i.cover_invert,i.dark_text=!!i.dark_text,i.show_door_closed=!!i.show_door_closed,i.color_door_open=(i.color_door_open??"").trim(),i.color_door_open_dark=(i.color_door_open_dark??"").trim(),i.color_door_closed=(i.color_door_closed??"").trim(),i.color_door_closed_dark=(i.color_door_closed_dark??"").trim(),i.color_on=(i.color_on??"").trim(),i.color_cover=(i.color_cover??"").trim(),i.color_on_dark=(i.color_on_dark??"").trim(),i.color_cover_dark=(i.color_cover_dark??"").trim(),i.max_buttons=Number.isFinite(Number(i.max_buttons))?Number(i.max_buttons):4,i.max_buttons=n(i.max_buttons,1,4),i.buttons=Array.isArray(i.buttons)?i.buttons:[],i.buttons=i.buttons.map((e=>({entity:(e?.entity??"").trim(),icon:(e?.icon??"").trim(),type:((e?.type??"entity")+"").trim().toLowerCase(),nav_path:(e?.nav_path??"").trim(),service:(e?.service??"").trim(),service_data:e?.service_data&&"object"==typeof e.service_data?e.service_data:void 0}))),t||(i.buttons=i.buttons.filter((e=>"entity"!==(e.type||"entity")||""!==(e.entity||"").trim()))),i};class c extends HTMLElement{_coverDir={};_popupOpen=!1;_built=!1;_hasRenderedOnce=!1;_lastStates={};_renderRaf=null;_trackedEntities=[];_miniNodes=[];_popupMiniNodes=[];_popupLabels=[];_nudge={x:-2,y:-1,yBadge:-4,coverY:-1,coverYBadge:-5};_handleWindowKeydown=e=>{"Escape"===e.key&&this._popupOpen&&this._closePopup()};connectedCallback(){window.addEventListener("keydown",this._handleWindowKeydown)}disconnectedCallback(){window.removeEventListener("keydown",this._handleWindowKeydown)}static getStubConfig(){return{type:`custom:${e}`,name:"",icon:"mdi:home",temp_entity:"",humidity_entity:"",window_entity:"",nav_path:"/home/areas",cover_invert:!0,dark_text:!1,max_buttons:4,buttons:[{entity:"",icon:"",type:"entity"}]}}static getConfigElement(){return document.createElement(t)}setConfig(e){if(!e)throw new Error("No config provided");this._config=l(e,{keepEmptyButtons:!0}),this._config.dark_text?this.classList.add("dark-text"):this.classList.remove("dark-text"),this._ensureBuilt();const t=(e,t)=>{t?this.style.setProperty(e,t):this.style.removeProperty(e)};t("--config-color-on",this._config.color_on),t("--config-color-cover",this._config.color_cover),t("--config-color-on-dark",this._config.color_on_dark),t("--config-color-cover-dark",this._config.color_cover_dark),this._renderStatic(),this._lastStates={},this._hasRenderedOnce=!1,this._updatePreviewBackground(),this._hass&&(this._renderDynamic(),this._renderPopupDynamic())}set hass(e){if(this._hass=e,!this._config||!this._built)return;let t=!1;for(const n of this._trackedEntities)e.states[n]!==this._lastStates[n]&&(t=!0,this._lastStates[n]=e.states[n]);!t&&this._hasRenderedOnce||(this._hasRenderedOnce=!0,this._renderRaf&&cancelAnimationFrame(this._renderRaf),this._renderRaf=requestAnimationFrame((()=>{this._renderDynamic(),this._popupOpen&&this._renderPopupDynamic()})))}_updatePreviewBackground(){setTimeout((()=>{let e=this.parentElement;e&&"hui-card-preview"!==e.localName&&e.getRootNode&&(e=e.getRootNode().host),e&&"hui-card-preview"===e.localName&&(this._config.dark_text?(e.style.background="linear-gradient(135deg, #d6e8ff 0%, #b8d4ff 100%)",e.style.padding="24px",e.style.borderRadius="16px",e.style.boxShadow="inset 0 0 20px rgba(255,255,255,0.5)"):(e.style.background="",e.style.padding="",e.style.borderRadius="",e.style.boxShadow=""))}),50)}getCardSize(){return 1}_coverPos(e){const t=e?.attributes?.current_position;if("number"!=typeof t)return null;const i=n(t,0,100);return this._config?.cover_invert?100-i:i}_isCoverMoving(e){const t=String(e?.state??"").toLowerCase();return"opening"===t||"closing"===t}_canMasterOff(){return(this._allButtons||[]).some((e=>{const t=(e.entity||"").trim();if(!t)return!1;const n=o(this._hass,t),r=i(t);return n&&["light","switch","fan","input_boolean"].includes(r)&&"on"===String(n.state).toLowerCase()}))}_handleMasterOff(){let e=!1;(this._allButtons||[]).forEach((t=>{const n=(t.entity||"").trim();if(!n)return;const r=o(this._hass,n),s=i(n);r&&["light","switch","fan","input_boolean"].includes(s)&&"on"===String(r.state).toLowerCase()&&(this._hass.callService("homeassistant","turn_off",{entity_id:n}),e=!0)})),e&&r(this,"haptic","heavy")}_ensureBuilt(){if(this._built)return;this._built=!0,this.attachShadow({mode:"open"});const e=document.createElement("style");e.textContent='\n    * { box-sizing: border-box; }\n\n    :host {\n      --smarvy-text-color: var(--primary-text-color);\n      --smarvy-theme-bg: var(--card-background-color, var(--primary-background-color, #ffffff));\n      \n      --smarvy-on: var(--config-color-on, var(--state-icon-active-color, #fdd835));\n      --smarvy-cover-on: var(--config-color-cover, #34c759);\n      \n      --smarvy-glass-bg: color-mix(in srgb, var(--smarvy-theme-bg) 30%, transparent);\n      --smarvy-glass-hover: color-mix(in srgb, var(--smarvy-theme-bg) 40%, transparent);\n      --smarvy-glass-btn: transparent;\n      --smarvy-glass-btn-hover: color-mix(in srgb, var(--smarvy-text-color) 6%, transparent);\n      --smarvy-border: color-mix(in srgb, var(--smarvy-text-color) 12%, transparent);\n      --smarvy-icon-inactive: color-mix(in srgb, var(--smarvy-text-color) 60%, transparent);\n\n      --smarvy-glass-edge: rgba(255, 255, 255, 0.15);\n      --smarvy-glass-shimmer: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0) 35%);\n      --smarvy-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);\n      \n      --smarvy-active-btn-bg: color-mix(in srgb, var(--smarvy-on) 15%, transparent);\n      --smarvy-active-cover-bg: color-mix(in srgb, var(--smarvy-cover-on) 15%, transparent);\n      --smarvy-active-card-bg: linear-gradient(135deg, color-mix(in srgb, var(--smarvy-glass-bg) 85%, var(--smarvy-on)), var(--smarvy-glass-bg) 100%);\n      --smarvy-main-icon-active: var(--smarvy-on);\n      \n      --smarvy-on-glow: 0 0 15px color-mix(in srgb, var(--smarvy-on) 15%, transparent);\n      --smarvy-cover-glow: 0 0 15px color-mix(in srgb, var(--smarvy-cover-on) 15%, transparent);\n\n      --smarvy-veil-color: rgba(255, 255, 255, 0.25);\n    }\n    \n    :host(.dark-text) {\n      --smarvy-text-color: #1c1c1e;\n      --smarvy-theme-bg: #ffffff;\n      \n      --smarvy-on: var(--config-color-on-dark, #cc8d14); \n      --smarvy-cover-on: var(--config-color-cover-dark, #305e3b);\n      \n      --smarvy-glass-bg: color-mix(in srgb, var(--smarvy-theme-bg) 20%, transparent);\n      --smarvy-border: color-mix(in srgb, var(--smarvy-text-color) 20%, transparent);\n\n      --smarvy-glass-edge: rgba(255, 255, 255, 0.5); \n      --smarvy-glass-shimmer: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0) 40%);\n      --smarvy-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);\n      \n      --smarvy-active-btn-bg: rgba(255, 255, 255, 0.95);\n      --smarvy-active-cover-bg: rgba(255, 255, 255, 0.95);\n      \n      --smarvy-active-card-bg: linear-gradient(135deg, color-mix(in srgb, var(--smarvy-glass-bg) 85%, var(--smarvy-on)), var(--smarvy-glass-bg) 100%);\n      --smarvy-main-icon-active: var(--smarvy-text-color); \n      \n      --smarvy-on-glow: 0 4px 12px color-mix(in srgb, var(--smarvy-on) 20%, transparent);\n      --smarvy-cover-glow: 0 4px 12px color-mix(in srgb, var(--smarvy-cover-on) 20%, transparent);\n      --smarvy-veil-color: rgba(44, 44, 46, 0.3);\n    }\n\n    ha-card { \n      border-radius: 20px; padding: 16px; cursor: pointer;\n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-bg);\n      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);\n      border: 1px solid var(--smarvy-border);\n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), var(--smarvy-shadow);\n      transform: translateZ(0); \n      transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.3s ease, background 0.3s ease, border-color 0.3s ease;\n    }\n    ha-card:hover {\n      transform: translateY(-2px) translateZ(0);\n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), 0 12px 40px rgba(0, 0, 0, 0.15);\n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-hover);\n    }\n    ha-card.card-is-active {\n      background: var(--smarvy-glass-shimmer), var(--smarvy-active-card-bg);\n      border-color: color-mix(in srgb, var(--smarvy-border) 70%, var(--smarvy-on));\n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), var(--smarvy-shadow);\n    }\n    ha-card.card-is-active:hover {\n      background: var(--smarvy-glass-shimmer), var(--smarvy-active-card-bg);\n    }\n\n    .row { display: flex; align-items: center; gap: 12px; min-height: 48px; }\n    \n    /* Neuer Master-Button (Squircle, nah am Rand, bricht die Kartenh√∂he nicht) */\n    /* Neuer Master-Button (Squircle, nah am Rand, bricht die Kartenh√∂he nicht) */\n    .main-button {\n      position: relative; width: 48px; height: 58px; border-radius: 16px;\n      margin: -5px 0 -5px -6px; /* Zieht den Button in das Padding der Karte rein */\n      display: flex; align-items: center; justify-content: center; flex-shrink: 0;\n      cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation;\n      \n      /* Apple Fixes (verhindert Textmarkierung auf dem iPad) */\n      -webkit-touch-callout: none;\n      -webkit-user-select: none;\n      \n      overflow: hidden;\n      background: color-mix(in srgb, var(--smarvy-glass-btn) 10%, transparent); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border);\n      \n      /* WICHTIG: \'transform\' hinzugef√ºgt, damit er beim Loslassen wieder weich schrumpft */\n      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.3s ease, box-shadow 0.3s ease;\n    }\n    .main-button:hover {\n      background: color-mix(in srgb, var(--smarvy-glass-btn-hover) 50%, transparent);\n    }\n\n    /* --- NEU: HIER WIRD DAS WACHSEN BEIM HALTEN EINGESTELLT --- */\n    .main-button.is-touch.long-pressing {\n      /* scale(1.15) bedeutet 15% gr√∂√üer. \n         - 1.0 ist Normalgr√∂√üe. \n         - 1.3 w√§re 30% gr√∂√üer. \n         Spiel hier mit dem Wert (z.B. 1.1, 1.2), bis er perfekt auf die Karte passt! */\n      transform: scale(1.15) !important; \n      \n      z-index: 50; /* Zieht den Button √ºber die anderen Elemente */\n      box-shadow: 0 20px 40px rgba(0,0,0,0.25), inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border) !important;\n      transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), box-shadow 0.6s ease-out !important;\n    }\n    /* --------------------------------------------------------- */\n\n    .main-button .veil {\n      position: absolute; top: 0; left: 0; height: 100%; width: 0%;\n      background: var(--smarvy-veil-color); pointer-events: none; z-index: 1; transition: width 0.3s ease-out;\n    }\n    .main-button.long-pressing .veil { transition: width 0.6s linear; width: 100%; }\n    .main-button.no-transition .veil { transition: none !important; width: 0 !important; }\n    .main-icon { position: relative; z-index: 2; width: 26px; height: 26px; color: var(--smarvy-text-color); opacity: 0.9; transition: color 0.3s ease; transform: translate(1px, 0px); }\n\n    .name-wrap { display: flex; flex-direction: column; min-width: 0; flex-grow: 1; align-items: flex-start; justify-content: center; }\n    .name { color: var(--smarvy-text-color); font-size: 18px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; width: 100%; text-align: left; }\n    \n    .temp-badge { \n      display: inline-flex; align-items: center; gap: 2px; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); \n      padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; margin-top: 6px; color: var(--smarvy-text-color); opacity: 0.85; transition: background 0.2s ease, box-shadow 0.2s ease; \n    }\n    \n    .btns { display: flex; gap: 8px; flex: 0 0 192px; justify-content: flex-end; align-items: center; }\n    \n    .mini { \n      position: relative; width: 42px; height: 42px; border-radius: 16px; display: grid; place-items: center; cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation;\n      overflow: hidden; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); \n      color: var(--smarvy-icon-inactive); \n      --smarvy-glow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); \n      box-shadow: var(--smarvy-glow); \n      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease, color 0.2s ease; \n    }\n    .mini:hover { \n      transform: translateY(-2px) scale(1.05); \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn-hover); \n      box-shadow: var(--smarvy-glow), 0 4px 12px rgba(0,0,0,0.05); \n    }\n    .mini:active { transform: scale(0.95); }\n    \n    .mini.is-touch.long-pressing {\n      transform: scale(1.45) !important;\n      z-index: 50;\n      box-shadow: 0 20px 40px rgba(0,0,0,0.25), var(--smarvy-glow) !important;\n      transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), box-shadow 0.6s ease-out !important;\n    }\n\n    .mini .veil {\n      position: absolute; top: 0; left: 0; height: 100%; width: 0%;\n      background: var(--smarvy-veil-color);\n      pointer-events: none;\n      z-index: 1;\n      transition: width 0.3s ease-out; \n    }\n    .mini.long-pressing .veil { transition: width 0.6s linear; width: 100%; }\n    .mini.no-transition .veil { transition: none !important; width: 0 !important; }\n\n    .mini ha-icon, .iconWrap, .spinner-track, .badge { position: relative; z-index: 2; }\n    \n    .mini.is-on { \n      background: var(--smarvy-active-btn-bg) !important; \n      color: var(--smarvy-on) !important; \n      --smarvy-glow: inset 0 0 0 1px color-mix(in srgb, var(--smarvy-on) 40%, transparent), var(--smarvy-on-glow) !important; \n      box-shadow: var(--smarvy-glow) !important; \n    }\n    .mini.is-on-cover, .mini.is-moving { \n      background: var(--smarvy-active-cover-bg) !important; \n      color: var(--smarvy-cover-on) !important; \n      --smarvy-glow: inset 0 0 0 1px color-mix(in srgb, var(--smarvy-cover-on) 40%, transparent), var(--smarvy-cover-glow) !important; \n      box-shadow: var(--smarvy-glow) !important; \n    }\n\n    .mini .iconWrap { position: absolute; inset: 0; display: grid; place-items: center; line-height: 0; pointer-events: none; }\n    @keyframes smarvySpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }\n    .mini.is-spinning .iconWrap { animation: smarvySpin 1.5s linear infinite; }\n    .mini ha-icon { width: 20px; height: 20px; display: block; color: currentColor; transform: translate(var(--icon-nudge-x, 0px), var(--icon-nudge-y, -1px)); }\n    .mini.has-badge ha-icon { transform: translate(var(--icon-nudge-x, 0px), var(--icon-nudge-y-badge, -4px)); }\n    @keyframes squircleSpinCw { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n    @keyframes squircleSpinCcw { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }\n    .spinner-track { position: absolute; inset: 0; border-radius: inherit; overflow: hidden; padding: 1.5px; -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude; pointer-events: none; opacity: 0; transition: opacity 0.3s ease; }\n    .mini.is-moving .spinner-track { opacity: 1; }\n    .spinner-track::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; animation-play-state: paused !important; }\n    .mini.is-moving .spinner-track::before { animation-play-state: running !important; }\n    .mini[data-last-dir="down"] .spinner-track::before { background: conic-gradient(transparent 30%, var(--smarvy-cover-on) 100%); animation: squircleSpinCw 3s linear infinite; }\n    .mini[data-last-dir="up"] .spinner-track::before { background: conic-gradient(var(--smarvy-cover-on) 0%, transparent 70%); animation: squircleSpinCcw 3s linear infinite; }\n    .mini[aria-disabled="true"] { opacity: 0.45; cursor: not-allowed; }\n    .badge { position: absolute; left: 0; right: 0; bottom: 3px; text-align: center; font-size: 10px; line-height: 10px; font-weight: 600; opacity: 0.9; pointer-events: none; color: currentColor; display: none; }\n    \n    @media (max-width: 450px) { .btns { flex: 0 0 142px; } }\n    @media (max-width: 380px) { \n      .mini { width: 36px; height: 36px; border-radius: 12px; } \n      .mini ha-icon { width: 18px; height: 18px; } \n      .btns { gap: 6px; flex: 0 0 120px; } \n      .name { font-size: 16px; } \n      ha-card { padding: 12px; } \n      .main-button { width: 44px; height: 50px; border-radius: 12px; margin: -4px 0 -4px -4px; }\n      .main-icon { width: 22px; height: 22px; }\n    }\n    @media (max-width: 420px) { .window-text { display: none; } .window-icon { margin-right: 0 !important; } }\n    \n    .overlay { \n      position: fixed; inset: 0; background: transparent; \n      visibility: hidden; z-index: 1; pointer-events: none; \n      transition: visibility 0s linear 0.3s; \n    }\n    .overlay.open { \n      visibility: visible; pointer-events: auto; \n      transition: visibility 0s linear 0s; \n    }\n    \n    .dialog { \n      position: absolute; left: 50%; top: 50%; \n      transform: translate3d(-50%, -50%, 0); \n      opacity: 0; \n      width: min(620px, calc(100vw - 40px)); \n      border-radius: 24px; overflow: hidden; touch-action: pan-y; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-bg); \n      border: 1px solid var(--smarvy-border); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), 0 24px 48px rgba(0,0,0,0.3), 0 0 0 150vmax rgba(0,0,0,0.45); \n      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); \n      will-change: opacity, transform; \n      transition: opacity 0.3s ease, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); \n    }\n    \n    .overlay.open .dialog { opacity: 1; }\n    .dialog.is-swiping { transition: none !important; }\n    \n    .dialog-inner { \n      padding: 20px; max-height: min(75vh, 640px); overflow-y: auto; opacity: 0; transition: opacity 0.3s ease; \n      overscroll-behavior: contain; -webkit-overflow-scrolling: touch; \n    }\n    .overlay.open .dialog-inner { opacity: 1; }\n    \n    .swipe-handle { width: 40px; height: 5px; background: color-mix(in srgb, var(--smarvy-text-color) 25%, transparent); border-radius: 3px; margin: 0 auto 16px auto; display: block; }\n    .dialogHeader { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 20px; padding: 0 4px; }\n    .dialogTitle { color: var(--smarvy-text-color); font-weight: 700; font-size: 18px; opacity: 0.95; }\n    .dialogHint { color: var(--smarvy-text-color); margin-top: 4px; font-size: 13px; opacity: 0.6; }\n    \n    .closeBtn { \n      width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); \n      color: var(--smarvy-text-color); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); \n      transition: background 0.2s ease, transform 0.2s ease; \n    }\n    .closeBtn:hover { background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn-hover); transform: scale(1.05); }\n    .closeBtn ha-icon { display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; color: currentColor; }\n    \n    .grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); justify-content: center; justify-items: center; }\n    \n    .cell { \n      width: 100%; max-width: 150px; display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 12px 8px; border-radius: 20px; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); \n      opacity: 0; transform: translateY(15px); transition: transform 0.3s ease, opacity 0.3s ease; \n    }\n    .overlay.open .cell { opacity: 1; transform: translateY(0); transition-delay: var(--delay, 0s); }\n    .cellLabel { \n      width: 100%; text-align: center; color: var(--smarvy-text-color); font-size: 12px; font-weight: 500; opacity: 0.85; line-height: 1.2; min-height: 28px; \n      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; word-break: break-word; \n    }\n  ',this._cardNode=document.createElement("ha-card");const t=document.createElement("div");t.className="row",this._mainButton=document.createElement("div"),this._mainButton.className="main-button";const n=document.createElement("div");n.className="veil",this._mainButton.appendChild(n),this._mainIcon=document.createElement("ha-icon"),this._mainIcon.className="main-icon",this._mainButton.appendChild(this._mainIcon),this._attachPressHandlers(this._mainButton,{onTap:null,onHold:()=>this._handleMasterOff(),canLongPress:()=>this._canMasterOff()});const i=document.createElement("div");i.className="name-wrap",this._mainName=document.createElement("div"),this._mainName.className="name",this._tempBadge=document.createElement("div"),this._tempBadge.className="temp-badge",i.appendChild(this._mainName),i.appendChild(this._tempBadge),this._btns=document.createElement("div"),this._btns.className="btns",t.appendChild(this._mainButton),t.appendChild(i),t.appendChild(this._btns),this._cardNode.appendChild(t),this._cardNode.addEventListener("click",(()=>{if(!this._config)return;const e=(this._config.nav_path||"").trim();e&&(window.history.pushState(null,"",e),window.dispatchEvent(new CustomEvent("location-changed")))})),this._overlay=document.createElement("div"),this._overlay.className="overlay",this._overlay.addEventListener("touchmove",(e=>{e.target===this._overlay&&e.preventDefault()}),{passive:!1}),this._overlay.addEventListener("click",(e=>{e.target===this._overlay&&this._closePopup()}));const o=document.createElement("div");o.className="dialog";const s=document.createElement("div");s.className="dialog-inner";const a=document.createElement("div");a.className="swipe-handle";const l=document.createElement("div");l.className="dialogHeader";const c=document.createElement("div"),d=document.createElement("div");d.className="dialogTitle",d.textContent="Steuerung";const h=document.createElement("div");h.className="dialogHint",h.textContent="Tipp: Halten f√ºr Details",c.appendChild(d),c.appendChild(h);const p=document.createElement("div");p.className="closeBtn",p.setAttribute("role","button"),p.setAttribute("tabindex","0");const m=document.createElement("ha-icon");m.setAttribute("icon","mdi:close"),p.appendChild(m),p.addEventListener("click",(e=>{e.stopPropagation(),this._closePopup()})),l.appendChild(c),l.appendChild(p),this._popupGrid=document.createElement("div"),this._popupGrid.className="grid",s.appendChild(a),s.appendChild(l),s.appendChild(this._popupGrid),o.appendChild(s),this._overlay.appendChild(o);let v=0,u=!1,_=!1,g=null;o.addEventListener("touchstart",(e=>{v=e.touches[0].clientY,s.scrollTop<=0?(u=!0,_=!1,o.style.transition="none"):u=!1}),{passive:!0}),o.addEventListener("touchmove",(e=>{const t=e.touches[0].clientY-v;if(u&&t>0)return e.preventDefault(),o.classList.add("is-swiping"),t>90&&!_&&(r(this,"haptic","light"),_=!0),g&&cancelAnimationFrame(g),void(g=requestAnimationFrame((()=>{o.style.transform=`translate3d(-50%, calc(-50% + ${.4*t}px), 0)`})));if(e.composedPath().includes(s)){if(s.scrollHeight>s.clientHeight){const n=s.scrollTop<=0,i=s.scrollTop+s.clientHeight>=s.scrollHeight;(n&&t>0||i&&t<0)&&e.preventDefault()}else e.preventDefault()}else e.preventDefault()}),{passive:!1}),o.addEventListener("touchend",(e=>{if(!u)return;u=!1;const t=e.changedTouches[0].clientY-v;o.classList.remove("is-swiping"),g&&cancelAnimationFrame(g),o.style.transition="transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)",o.style.transform="translate3d(-50%, -50%, 0)",t>90&&this._closePopup()}),{passive:!0}),this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(this._cardNode),this.shadowRoot.appendChild(this._overlay)}_hasActiveHiddenEntities(){if(!this._allButtons||!this._rowButtons)return!1;return this._allButtons.slice(this._rowButtons.length).some((e=>{const t=(e.entity||"").trim();if(!t)return!1;const n=o(this._hass,t),r=i(t);return n&&["light","switch","fan","input_boolean"].includes(r)&&"on"===String(n.state).toLowerCase()}))}_applyEventShield(e=800){const t=document.createElement("div");t.style.cssText="position: fixed; inset: 0; z-index: 999999; background: transparent; touch-action: none;";const n=e=>{e.preventDefault(),e.stopPropagation()};["click","pointerup","touchend","mousedown","mouseup"].forEach((e=>{t.addEventListener(e,n,{capture:!0,passive:!1})})),document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),e)}_attachPressHandlers(e,{onTap:t,onHold:n,onQuickOff:i,canLongPress:o}){let r=null,s=null,a=!1,l=!1,c=!1;const d=()=>{r&&clearTimeout(r),s&&clearTimeout(s),r=null,s=null,l?(e.classList.add("no-transition"),e.classList.remove("long-pressing","is-touch"),setTimeout((()=>{e.classList.remove("no-transition")}),100)):e.classList.remove("long-pressing","is-touch"),setTimeout((()=>{a=!1}),100)},h=t=>{t&&"mouse"===t.pointerType&&0!==t.button||o&&!o()||(r&&clearTimeout(r),s&&clearTimeout(s),a=!1,l=!1,r=setTimeout((()=>{c&&e.classList.add("is-touch"),e.classList.add("long-pressing"),a=!0,s=setTimeout((()=>{l=!0,i?i():n&&n()}),600)}),250))};e.addEventListener("contextmenu",(e=>e.preventDefault())),e.addEventListener("pointerdown",(t=>{t.pointerType&&(c="touch"===t.pointerType||"pen"===t.pointerType),"true"!==e.getAttribute("aria-disabled")&&h(t)})),e.addEventListener("pointerup",d),e.addEventListener("pointercancel",d),e.addEventListener("pointerleave",d),e.addEventListener("touchstart",(t=>{c=!0,"true"!==e.getAttribute("aria-disabled")&&h(t)}),{passive:!0}),e.addEventListener("touchend",d,{passive:!0}),e.addEventListener("touchcancel",d,{passive:!0}),e.addEventListener("click",(n=>{n.stopPropagation(),"true"===e.getAttribute("aria-disabled")||a||t?.()}))}_openPopup(){this._popupOpen=!0,this._overlay.classList.add("open"),this._renderPopupDynamic()}_closePopup(){this._popupOpen=!1,this._overlay.classList.remove("open")}_getRenderableButtons(){return(this._config?.buttons||[]).filter((e=>"entity"!==(e.type||"entity")||""!==(e.entity||"").trim()))}_setBadge(e,t){const n=e?._badgeNode;if(!n)return;const i=!(!t||!String(t).trim());n.style.display=i?"block":"none",n.textContent=i?String(t):"",e.classList.toggle("has-badge",i)}_setIconNudge(e,{x:t,y:n,yBadge:i}){e&&(null!=t&&e.style.setProperty("--icon-nudge-x",`${t}px`),null!=n&&e.style.setProperty("--icon-nudge-y",`${n}px`),null!=i&&e.style.setProperty("--icon-nudge-y-badge",`${i}px`))}_handleQuickOff(){const e=this._allButtons.slice(this._rowButtons.length);let t=!1;e.forEach((e=>{const n=(e.entity||"").trim();if(n){const e=o(this._hass,n),r=i(n);e&&["light","switch","fan","input_boolean"].includes(r)&&"on"===String(e.state).toLowerCase()&&(this._hass.callService("homeassistant","turn_off",{entity_id:n}),t=!0)}})),t&&r(this,"haptic","heavy")}_createMini(e,t="normal"){const n=document.createElement("div");n.className="mini ring",n.dataset.kind=t,n.setAttribute("role","button"),n.setAttribute("tabindex","0");const i=document.createElement("div");i.className="veil",n.appendChild(i);const o=document.createElement("div");o.className="spinner-track",n.appendChild(o);const a=document.createElement("div");a.className="iconWrap";const l=document.createElement("ha-icon");l.setAttribute("icon",e?.icon||s(e?.entity)),a.appendChild(l),n.appendChild(a),n._iconNode=l;const c=document.createElement("div");return c.className="badge",c.style.display="none",n.appendChild(c),n._badgeNode=c,this._attachPressHandlers(n,{onTap:()=>{"overflow"!==t?this._handleButton(e):this._openPopup()},onHold:"overflow"===t?null:()=>{const n=(e?.entity||"").trim();n&&("normal"===t&&this._applyEventShield(800),r(this,"haptic","heavy"),r(this,"hass-more-info",{entityId:n}))},onQuickOff:"overflow"===t?()=>this._handleQuickOff():null,canLongPress:"overflow"===t?()=>this._hasActiveHiddenEntities():()=>!0}),n}_renderStatic(){if(!this._config)return;this._mainIcon.setAttribute("icon",this._config.icon||"mdi:home"),this._mainName.textContent=this._config.name||"";const e=this._getRenderableButtons(),t=n(this._config.max_buttons||4,1,4),i=e.length>t,o=i?Math.min(t,3):e.length,r=e.slice(0,o);if(this._btns.innerHTML="",this._miniNodes=[],r.forEach((e=>{const t=this._createMini(e,"normal");this._miniNodes.push(t),this._btns.appendChild(t)})),i){const e=this._createMini({icon:"mdi:dots-horizontal"},"overflow");this._miniNodes.push(e),this._btns.appendChild(e)}this._rowButtons=r,this._allButtons=e,this._hasOverflow=i,this._renderPopupStatic(),this._trackedEntities=[],this._config.temp_entity&&this._trackedEntities.push(this._config.temp_entity),this._config.humidity_entity&&this._trackedEntities.push(this._config.humidity_entity),this._config.window_entity&&this._trackedEntities.push(this._config.window_entity),this._allButtons.forEach((e=>{const t=(e.entity||"").trim();t&&!this._trackedEntities.includes(t)&&this._trackedEntities.push(t)}))}_renderPopupStatic(){if(!this._popupGrid)return;const e=this._allButtons||[];this._popupGrid.innerHTML="",this._popupMiniNodes=[],this._popupLabels=[],e.forEach(((e,t)=>{const n=document.createElement("div");n.className="cell",n.style.setProperty("--delay",.04*t+"s");const i=document.createElement("div");i.className="cellLabel",i.textContent=e.entity?a(this._hass,e.entity):`Button ${t+1}`,this._popupLabels.push(i);const o=this._createMini(e,"popup");o.dataset.popupIdx=String(t),this._popupMiniNodes.push(o),n.appendChild(i),n.appendChild(o),this._popupGrid.appendChild(n)})),this._popupButtons=e}_updateNodes(e,t){const n="var(--smarvy-icon-inactive)",r="var(--smarvy-on)";e.forEach(((e,a)=>{this._setIconNudge(e,{x:this._nudge.x,y:this._nudge.y,yBadge:this._nudge.yBadge});const l=e.dataset.kind,c=e._iconNode;if("overflow"===l){e.setAttribute("aria-disabled","false");let t=!1;if(this._allButtons&&this._rowButtons){this._allButtons.slice(this._rowButtons.length).forEach((e=>{const n=(e.entity||"").trim();if(n){const e=o(this._hass,n),r=i(n);e&&["light","switch","fan","input_boolean"].includes(r)&&"on"===String(e.state).toLowerCase()&&(t=!0)}}))}return t?(e.style.color=r,e.classList.add("is-on")):(e.style.color=n,e.classList.remove("is-on")),e.classList.remove("is-spinning","is-on-cover","is-moving"),this._setBadge(e,""),void(c&&c.setAttribute("icon","mdi:dots-horizontal"))}const d=t[a];if(!d)return;const h=(d.type||"entity").toLowerCase(),p=(d.entity||"").trim(),m=p?o(this._hass,p):null,v=i(p);if(e.setAttribute("aria-disabled","entity"===h&&p&&!m?"true":"false"),e.style.color=n,e.classList.remove("is-on","is-spinning","is-on-cover","is-moving"),this._setBadge(e,""),c)if("cover"===v&&m){this._setIconNudge(e,{x:this._nudge.x,y:this._nudge.coverY,yBadge:this._nudge.coverYBadge});const t=this._coverPos(m),n="number"==typeof m.attributes?.current_position?m.attributes.current_position:null,i=this._isCoverMoving(m),o=String(m.state||"").toLowerCase();if(i)e.classList.add("is-on-cover","is-moving"),c.setAttribute("icon","opening"===o?"mdi:arrow-up-bold":"mdi:arrow-down-bold"),e.dataset.lastDir="opening"===o?"up":"down",this._setBadge(e,null!==t?`${Math.round(t)}%`:"");else{const i=null!==n?n>=99:"open"===o;c.setAttribute("icon",i?"mdi:window-shutter-open":"mdi:window-shutter"),this._setBadge(e,null!==t?`${Math.round(t)}%`:"")}}else if(c.setAttribute("icon",d.icon||s(p)),m&&["light","switch","fan","input_boolean"].includes(v)){const t="on"===String(m.state).toLowerCase();e.classList.toggle("is-on",t),e.style.color=t?r:n,e.classList.toggle("is-spinning","fan"===v&&t)}}))}_renderDynamic(){if(!this._hass||!this._btns)return;const e=this._config.temp_entity?o(this._hass,this._config.temp_entity):null,t=this._config.humidity_entity?o(this._hass,this._config.humidity_entity):null,n=this._config.window_entity?o(this._hass,this._config.window_entity):null,r=this._config.dark_text?this._config.color_door_open_dark||"#7d2424":this._config.color_door_open||"#c23232",s=this._config.dark_text?this._config.color_door_closed_dark||"#397d50":this._config.color_door_closed||"#50de65";let a=[],l=!1;if(n){const e="on"===n.state||"open"===n.state,t="off"===n.state||"closed"===n.state;e?(l=!0,a.push(`<span class="window-badge-wrap" style="display: flex; align-items: center; color: ${r}; font-weight: bold;"><ha-icon class="window-icon" icon="mdi:window-open-variant" style="--mdc-icon-size: 14px; margin-right: 3px;"></ha-icon><span class="window-text">Offen</span></span>`)):this._config.show_door_closed&&t&&(l=!0,a.push(`<span class="window-badge-wrap" style="display: flex; align-items: center; color: ${s}; font-weight: bold;"><ha-icon class="window-icon" icon="mdi:door-sliding-lock" style="--mdc-icon-size: 14px; margin-right: 3px;"></ha-icon><span class="window-text">Zu</span></span>`))}if(e&&a.push(`<ha-icon icon="mdi:thermometer" style="--mdc-icon-size: 14px; margin-right: 2px;"></ha-icon>${e.state}${e.attributes.unit_of_measurement||""}`),t){const n=e||l?"4px":"0px";a.push(`<ha-icon icon="mdi:water-percent" style="--mdc-icon-size: 14px; margin-right: 2px; margin-left: ${n};"></ha-icon>${t.state}${t.attributes.unit_of_measurement||""}`)}a.length>0?(this._tempBadge.innerHTML=a.join(' <span style="opacity: 0.35; margin: 0 5px; font-weight: normal;">|</span> '),this._tempBadge.style.display="inline-flex"):this._tempBadge.style.display="none",this._updateNodes(this._miniNodes,this._rowButtons);let c=!1;(this._allButtons||[]).forEach((e=>{const t=(e.entity||"").trim();if(!t)return;const n=i(t),r=o(this._hass,t);r&&["light","switch","fan","input_boolean"].includes(n)&&"on"===String(r.state).toLowerCase()&&(c=!0)})),c?(this._cardNode.classList.add("card-is-active"),this._mainIcon.style.color="var(--smarvy-main-icon-active)"):(this._cardNode.classList.remove("card-is-active"),this._mainIcon.style.color="var(--smarvy-text-color)")}_renderPopupDynamic(){this._popupOpen&&this._hass&&this._popupGrid&&(this._updateNodes(this._popupMiniNodes,this._popupButtons),this._popupLabels.forEach(((e,t)=>{const n=this._popupButtons[t];n&&n.entity&&(e.textContent=a(this._hass,n.entity))})))}_handleButton(e){const t=this._hass;if(!t)return;const n=(e.type||"entity").toLowerCase();if("navigate"===n){const t=(e.nav_path||"").trim();return void(t&&r(this,"hass-navigate",{navigation_path:t}))}if("more-info"===n){const t=(e.entity||"").trim();return void(t&&r(this,"hass-more-info",{entityId:t}))}if("service"===n){const n=(e.service||"").trim(),[i,o]=n.split(".");if(!i||!o)return;const r={...e.service_data||{}};return e.entity&&null==r.entity_id&&(r.entity_id=e.entity),void t.callService(i,o,r)}const s=(e.entity||"").trim();if(!s)return;const a=o(t,s);if(!a)return;const l=i(s);if("cover"===l){const e=String(a.state||"").toLowerCase(),n="number"==typeof a.attributes?.current_position?a.attributes.current_position:null;if("opening"===e||"closing"===e)return this._coverDir[s]="opening"===e?"open":"close",void t.callService("cover","stop_cover",{entity_id:s});if(null!==n&&n<=0)return this._coverDir[s]="open",void t.callService("cover","open_cover",{entity_id:s});if(null!==n&&n>=99)return this._coverDir[s]="close",void t.callService("cover","close_cover",{entity_id:s});if("closed"===e)return this._coverDir[s]="open",void t.callService("cover","open_cover",{entity_id:s});if("open"===e&&null===n)return this._coverDir[s]="close",void t.callService("cover","close_cover",{entity_id:s});const i="open"===this._coverDir[s]?"close":"open";return this._coverDir[s]=i,void t.callService("cover","open"===i?"open_cover":"close_cover",{entity_id:s})}["light","switch","fan","input_boolean"].includes(l)?t.callService("homeassistant","toggle",{entity_id:s}):r(this,"hass-more-info",{entityId:s})}}class d extends HTMLElement{_built=!1;_emitTimer=null;_buttonElements=[];set hass(e){this._hass=e,this._els&&(this._els.tempPicker.hass=e,this._els.humidityPicker.hass=e,this._els.windowPicker.hass=e,this._buttonElements.forEach((t=>{t.entity&&(t.entity.hass=e)})))}setConfig(e){for(this._config=l(e,{keepEmptyButtons:!0});this._config.buttons.length<1;)this._config.buttons.push({entity:"",icon:"",type:"entity"});this._ensureBuilt(),this._syncForm()}_ensureBuilt(){if(this._built)return;this._built=!0,this.attachShadow({mode:"open"}),this.shadowRoot.addEventListener("click",(e=>e.stopPropagation())),this.shadowRoot.addEventListener("pointerdown",(e=>e.stopPropagation()));const e=document.createElement("style");e.textContent="\n    .card-config { display: flex; flex-direction: column; gap: 16px; }\n    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }\n    h3.section-title { font-family: var(--paper-font-body1_-_font-family, Roboto, sans-serif); font-size: 16px; font-weight: 500; color: var(--secondary-text-color); margin: 0 0 12px 0; border-bottom: 1px solid var(--divider-color, rgba(120, 120, 120, 0.2)); padding-bottom: 8px; }\n    .switch-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; }\n    .switch-row span { font-family: var(--paper-font-body1_-_font-family, Roboto, sans-serif); color: var(--primary-text-color); }\n    .switch-row ha-switch { margin-left: 16px; }\n    .color-wrap { display: flex; align-items: center; gap: 8px; }\n    .color-wrap ha-textfield, .color-wrap ha-selector { flex: 1; min-width: 0; }\n    .list-container { display: flex; flex-direction: column; gap: 12px; }\n    \n    .list-item { \n        display: flex; align-items: center; gap: 8px; padding: 12px; \n        border: 1px solid var(--divider-color, rgba(120, 120, 120, 0.2)); \n        border-radius: var(--ha-card-border-radius, 12px); \n        background: var(--card-background-color, transparent); \n        transition: border-color 0.2s, opacity 0.2s, box-shadow 0.2s; \n    }\n    .list-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.05); }\n    .list-item.drag-over { border-color: var(--primary-color); border-width: 2px; }\n    .list-item.dragging { opacity: 0.4; }\n    \n    .handle { cursor: grab; color: var(--secondary-text-color); padding: 4px; display: flex; align-items: center; }\n    .handle:active { cursor: grabbing; }\n    \n    .item-content { flex: 1; display: grid; grid-template-columns: minmax(0, 1fr) 80px; gap: 40px; align-items: center; }\n    .entity-wrap { display: flex; align-items: center; gap: 4px; width: 100%; min-width: 0; }\n    .entity-wrap ha-selector { flex: 1; width: 100%; }\n    .icon-wrap { display: flex; align-items: center; width: 100%; min-width: 0; margin-top: 26px; }\n    .icon-wrap ha-icon-picker { flex: 1; width: 100%; }\n    \n    @media (max-width: 600px) { .item-content { grid-template-columns: 1fr; gap: 8px; } }\n    \n    .icon-btn { color: var(--secondary-text-color); cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 8px; border-radius: 50%; transition: background-color 0.2s, color 0.2s; }\n    .icon-btn:hover { color: var(--error-color, #ff3b30); background-color: rgba(255, 59, 48, 0.1); }\n    .icon-btn.disabled { opacity: 0.3; pointer-events: none; }\n    \n    ha-expansion-panel { border-radius: var(--ha-card-border-radius, 12px); margin-bottom: 0px; }\n  ";const t=document.createElement("div");t.className="card-config",t.innerHTML='\n        <ha-expansion-panel header="‚öôÔ∏è Allgemeine Einstellungen" outlined expanded>\n            <div style="padding: 16px 0 8px 0;">\n                <div class="grid">\n                    <ha-textfield id="name" label="Name (Titel)"></ha-textfield>\n                    <ha-icon-picker id="icon" label="Haupt-Icon"></ha-icon-picker>\n                    <ha-textfield id="navPath" label="Klick-Pfad (z.B. /areas/kueche)"></ha-textfield>\n                    <ha-textfield id="maxButtons" label="Sichtbare Slots (max. 4)" type="number" min="1" max="4"></ha-textfield>\n                </div>\n            </div>\n        </ha-expansion-panel>\n\n        <ha-expansion-panel header="üå°Ô∏è Sensoren" outlined>\n            <div style="padding: 16px 0 8px 0;">\n                <div class="grid">\n                    <div class="color-wrap">\n                        <ha-selector id="tempPicker"></ha-selector>\n                        <div id="clearTemp" class="icon-btn" title="Feld leeren" style="margin-top: 16px;"><ha-icon icon="mdi:close"></ha-icon></div>\n                    </div>\n                    <div class="color-wrap">\n                        <ha-selector id="humidityPicker"></ha-selector>\n                        <div id="clearHumidity" class="icon-btn" title="Feld leeren" style="margin-top: 16px;"><ha-icon icon="mdi:close"></ha-icon></div>\n                    </div>\n                    <div class="color-wrap">\n                        <ha-selector id="windowPicker"></ha-selector>\n                        <div id="clearWindow" class="icon-btn" title="Feld leeren" style="margin-top: 16px;"><ha-icon icon="mdi:close"></ha-icon></div>\n                    </div>\n                </div>\n                <div class="switch-row" style="margin-top: 12px;">\n                    <span>Fenster/T√ºr: Status "Zu" anzeigen (Standard: Nur "offen" wird angezeigt)</span>\n                    <ha-switch id="showDoorClosed"></ha-switch>\n                </div>\n            </div>\n        </ha-expansion-panel>\n\n        <ha-expansion-panel header="üé® Design & Farben" outlined>\n            <div style="padding: 16px 0 8px 0; display: flex; flex-direction: column; gap: 16px;">\n                <div class="switch-row">\n                    <span>Helles Design (F√ºr helle Hintergrundbilder)</span>\n                    <ha-switch id="darkText"></ha-switch>\n                </div>\n                <div class="switch-row">\n                    <span>Rollladen invertieren (0% = Offen)</span>\n                    <ha-switch id="invert"></ha-switch>\n                </div>\n\n                <div style="margin-top: 8px;">\n                    <h3 class="section-title" style="margin-bottom:0;">Farben anpassen</h3>\n                    <p style="font-size:12px; color:var(--secondary-text-color); margin: 0 0 16px 0;">Hex-Codes (z.B. #ff0000). Mit \'X\' leeren f√ºr Standardfarbe.</p>\n                    \n                    <div class="grid">\n                        \n                        <div class="color-wrap">\n                          <ha-textfield id="colorOn" label="Ger√§te (Normal)" placeholder="#fdd835"></ha-textfield>\n                          <div id="clearColorOn" class="icon-btn" title="Standardfarbe wiederherstellen"><ha-icon icon="mdi:close"></ha-icon></div>\n                        </div>\n                        <div class="color-wrap">\n                          <ha-textfield id="colorOnDark" label="Ger√§te (Helles Design)" placeholder="#cc8d14"></ha-textfield>\n                          <div id="clearColorOnDark" class="icon-btn" title="Standardfarbe wiederherstellen"><ha-icon icon="mdi:close"></ha-icon></div>\n                        </div>\n                        \n                        <div class="color-wrap">\n                          <ha-textfield id="colorCover" label="Rollladen (Normal)" placeholder="#34c759"></ha-textfield>\n                          <div id="clearColorCover" class="icon-btn" title="Standardfarbe wiederherstellen"><ha-icon icon="mdi:close"></ha-icon></div>\n                        </div>\n                        <div class="color-wrap">\n                          <ha-textfield id="colorCoverDark" label="Rollladen (Helles Design)" placeholder="#305e3b"></ha-textfield>\n                          <div id="clearColorCoverDark" class="icon-btn" title="Standardfarbe wiederherstellen"><ha-icon icon="mdi:close"></ha-icon></div>\n                        </div>\n\n                        <div class="color-wrap">\n                          <ha-textfield id="colorDoorOpen" label="T√ºr Offen (Normal)" placeholder="#c23232"></ha-textfield>\n                          <div id="clearColorDoorOpen" class="icon-btn" title="Standardfarbe wiederherstellen"><ha-icon icon="mdi:close"></ha-icon></div>\n                        </div>\n                        <div class="color-wrap">\n                          <ha-textfield id="colorDoorOpenDark" label="T√ºr Offen (Helles Design)" placeholder="#7d2424"></ha-textfield>\n                          <div id="clearColorDoorOpenDark" class="icon-btn" title="Standardfarbe wiederherstellen"><ha-icon icon="mdi:close"></ha-icon></div>\n                        </div>\n\n                        <div class="color-wrap">\n                          <ha-textfield id="colorDoorClosed" label="T√ºr Zu (Normal)" placeholder="#50de65"></ha-textfield>\n                          <div id="clearColorDoorClosed" class="icon-btn" title="Standardfarbe wiederherstellen"><ha-icon icon="mdi:close"></ha-icon></div>\n                        </div>\n                        <div class="color-wrap">\n                          <ha-textfield id="colorDoorClosedDark" label="T√ºr Zu (Helles Design)" placeholder="#397d50"></ha-textfield>\n                          <div id="clearColorDoorClosedDark" class="icon-btn" title="Standardfarbe wiederherstellen"><ha-icon icon="mdi:close"></ha-icon></div>\n                        </div>\n\n                    </div>\n                </div>\n            </div>\n        </ha-expansion-panel>\n\n        <ha-expansion-panel header="üí° Ger√§te & Buttons" outlined>\n            <div style="padding: 16px 0 8px 0;">\n                <div id="buttonsWrap" class="list-container"></div>\n                <ha-button id="addBtn" outlined style="margin-top: 16px;">\n                    <ha-icon icon="mdi:plus" slot="icon"></ha-icon>\n                    Ger√§t hinzuf√ºgen\n                </ha-button>\n            </div>\n        </ha-expansion-panel>\n      ',this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(t),this._els={name:t.querySelector("#name"),icon:t.querySelector("#icon"),navPath:t.querySelector("#navPath"),maxButtons:t.querySelector("#maxButtons"),tempPicker:t.querySelector("#tempPicker"),humidityPicker:t.querySelector("#humidityPicker"),windowPicker:t.querySelector("#windowPicker"),showDoorClosed:t.querySelector("#showDoorClosed"),darkText:t.querySelector("#darkText"),invert:t.querySelector("#invert"),colorOn:t.querySelector("#colorOn"),colorOnDark:t.querySelector("#colorOnDark"),colorCover:t.querySelector("#colorCover"),colorCoverDark:t.querySelector("#colorCoverDark"),colorDoorOpen:t.querySelector("#colorDoorOpen"),colorDoorOpenDark:t.querySelector("#colorDoorOpenDark"),colorDoorClosed:t.querySelector("#colorDoorClosed"),colorDoorClosedDark:t.querySelector("#colorDoorClosedDark"),buttonsWrap:t.querySelector("#buttonsWrap"),addBtn:t.querySelector("#addBtn")},this._els.tempPicker.label="Temperatur Sensor",this._els.tempPicker.selector={entity:{domain:["sensor","input_number"]}},this._els.humidityPicker.label="Luftfeuchtigkeit Sensor",this._els.humidityPicker.selector={entity:{domain:["sensor","input_number"]}},this._els.windowPicker.label="Fenster/T√ºr Sensor",this._els.windowPicker.selector={entity:{domain:["binary_sensor"],device_class:["window","door","opening"]}},this._els.name.addEventListener("input",(e=>this._updateConfig("name",e.target.value))),this._els.icon.addEventListener("value-changed",(e=>this._updateConfig("icon",e.detail.value))),this._els.navPath.addEventListener("input",(e=>this._updateConfig("nav_path",e.target.value))),this._els.maxButtons.addEventListener("input",(e=>{let t=parseInt(e.target.value,10);if(!isNaN(t)){let i=n(t,1,4);e.target.value=i,this._updateConfig("max_buttons",i)}})),this._els.tempPicker.addEventListener("value-changed",(e=>this._updateConfig("temp_entity",e.detail.value))),t.querySelector("#clearTemp").addEventListener("click",(()=>{this._updateConfig("temp_entity",""),this._syncForm()})),t.querySelector("#clearHumidity").addEventListener("click",(()=>{this._updateConfig("humidity_entity",""),this._syncForm()})),t.querySelector("#clearWindow").addEventListener("click",(()=>{this._updateConfig("window_entity",""),this._syncForm()})),this._els.humidityPicker.addEventListener("value-changed",(e=>this._updateConfig("humidity_entity",e.detail.value))),this._els.windowPicker.addEventListener("value-changed",(e=>this._updateConfig("window_entity",e.detail.value))),this._els.showDoorClosed.addEventListener("change",(e=>this._updateConfig("show_door_closed",e.target.checked))),this._els.darkText.addEventListener("change",(e=>this._updateConfig("dark_text",e.target.checked))),this._els.invert.addEventListener("change",(e=>this._updateConfig("cover_invert",e.target.checked))),this._els.colorOn.addEventListener("input",(e=>this._updateConfig("color_on",e.target.value))),t.querySelector("#clearColorOn").addEventListener("click",(()=>{this._updateConfig("color_on",""),this._syncForm()})),this._els.colorOnDark.addEventListener("input",(e=>this._updateConfig("color_on_dark",e.target.value))),t.querySelector("#clearColorOnDark").addEventListener("click",(()=>{this._updateConfig("color_on_dark",""),this._syncForm()})),this._els.colorCover.addEventListener("input",(e=>this._updateConfig("color_cover",e.target.value))),t.querySelector("#clearColorCover").addEventListener("click",(()=>{this._updateConfig("color_cover",""),this._syncForm()})),this._els.colorCoverDark.addEventListener("input",(e=>this._updateConfig("color_cover_dark",e.target.value))),t.querySelector("#clearColorCoverDark").addEventListener("click",(()=>{this._updateConfig("color_cover_dark",""),this._syncForm()})),this._els.colorDoorOpen.addEventListener("input",(e=>this._updateConfig("color_door_open",e.target.value))),t.querySelector("#clearColorDoorOpen").addEventListener("click",(()=>{this._updateConfig("color_door_open",""),this._syncForm()})),this._els.colorDoorOpenDark.addEventListener("input",(e=>this._updateConfig("color_door_open_dark",e.target.value))),t.querySelector("#clearColorDoorOpenDark").addEventListener("click",(()=>{this._updateConfig("color_door_open_dark",""),this._syncForm()})),this._els.colorDoorClosed.addEventListener("input",(e=>this._updateConfig("color_door_closed",e.target.value))),t.querySelector("#clearColorDoorClosed").addEventListener("click",(()=>{this._updateConfig("color_door_closed",""),this._syncForm()})),this._els.colorDoorClosedDark.addEventListener("input",(e=>this._updateConfig("color_door_closed_dark",e.target.value))),t.querySelector("#clearColorDoorClosedDark").addEventListener("click",(()=>{this._updateConfig("color_door_closed_dark",""),this._syncForm()})),this._els.addBtn.addEventListener("click",(()=>{this._config.buttons.push({entity:"",icon:"",type:"entity"}),this._buildButtonListDOM(),this._emitDebounced()}))}_updateConfig(e,t){this._config[e]!==t&&(this._config[e]=t,this._emitDebounced())}_syncForm(){if(!this._config||!this._built)return;this._els.name.value!==(this._config.name||"")&&(this._els.name.value=this._config.name||""),this._els.icon.value!==(this._config.icon||"mdi:home")&&(this._els.icon.value=this._config.icon||"mdi:home"),this._els.navPath.value!==(this._config.nav_path||"")&&(this._els.navPath.value=this._config.nav_path||""),this._els.maxButtons.value!==String(this._config.max_buttons??4)&&(this._els.maxButtons.value=String(this._config.max_buttons??4)),this._els.tempPicker.value!==(this._config.temp_entity||"")&&(this._els.tempPicker.value=this._config.temp_entity||""),this._els.humidityPicker.value!==(this._config.humidity_entity||"")&&(this._els.humidityPicker.value=this._config.humidity_entity||""),this._els.windowPicker.value!==(this._config.window_entity||"")&&(this._els.windowPicker.value=this._config.window_entity||""),this._els.showDoorClosed.checked!==!!this._config.show_door_closed&&(this._els.showDoorClosed.checked=!!this._config.show_door_closed),this._els.darkText.checked!==!!this._config.dark_text&&(this._els.darkText.checked=!!this._config.dark_text),this._els.invert.checked!==!!this._config.cover_invert&&(this._els.invert.checked=!!this._config.cover_invert),this._els.colorOn.value!==(this._config.color_on||"")&&(this._els.colorOn.value=this._config.color_on||""),this._els.colorOnDark.value!==(this._config.color_on_dark||"")&&(this._els.colorOnDark.value=this._config.color_on_dark||""),this._els.colorCover.value!==(this._config.color_cover||"")&&(this._els.colorCover.value=this._config.color_cover||""),this._els.colorCoverDark.value!==(this._config.color_cover_dark||"")&&(this._els.colorCoverDark.value=this._config.color_cover_dark||""),this._els.colorDoorOpen.value!==(this._config.color_door_open||"")&&(this._els.colorDoorOpen.value=this._config.color_door_open||""),this._els.colorDoorOpenDark.value!==(this._config.color_door_open_dark||"")&&(this._els.colorDoorOpenDark.value=this._config.color_door_open_dark||""),this._els.colorDoorClosed.value!==(this._config.color_door_closed||"")&&(this._els.colorDoorClosed.value=this._config.color_door_closed||""),this._els.colorDoorClosedDark.value!==(this._config.color_door_closed_dark||"")&&(this._els.colorDoorClosedDark.value=this._config.color_door_closed_dark||"");const e=this._config.buttons||[];this._buttonElements.length!==e.length?this._buildButtonListDOM():e.forEach(((e,t)=>{const n=this._buttonElements[t];n.entity.value!==(e.entity||"")&&(n.entity.value=e.entity||""),n.icon.value!==(e.icon||"")&&(n.icon.value=e.icon||"")}))}_buildButtonListDOM(){this._els.buttonsWrap.innerHTML="",this._buttonElements=[],(this._config.buttons||[]).forEach(((e,t)=>{const n=document.createElement("div");n.className="list-item",n.draggable=!0,n.dataset.idx=String(t),n.innerHTML=`\n          <div class="handle" title="Ziehen zum Sortieren"><ha-icon icon="mdi:drag"></ha-icon></div>\n          <div class="item-content">\n              <div class="entity-wrap" id="ewrap-${t}"></div>\n              <div class="icon-wrap" id="iwrap-${t}"></div>\n          </div>\n          <div class="icon-btn delete-icon ${t<1?"disabled":""}" title="Ger√§t entfernen"><ha-icon icon="mdi:delete-outline"></ha-icon></div>\n        `;const i=n.querySelector(`#ewrap-${t}`),o=n.querySelector(`#iwrap-${t}`),r=n.querySelector(".delete-icon"),a=n.querySelector(".handle"),l=document.createElement("ha-selector");l.hass=this._hass,l.selector={entity:{}},l.label=`Entit√§t (Slot ${t+1})`,l.value=e.entity||"";const c=document.createElement("div");c.className="icon-btn",c.style.cssText="cursor:pointer; padding:4px; display:flex; align-items:center; margin-top: 25px;",c.innerHTML='<ha-icon icon="mdi:close"></ha-icon>',c.title="Feld leeren",c.addEventListener("click",(e=>{e.stopPropagation(),this._config.buttons[t].entity="",this._emitDebounced(),this._syncForm()}));const d=document.createElement("ha-icon-picker");l.addEventListener("value-changed",(e=>{e.stopPropagation();const n=(e.detail.value||"").trim();this._config.buttons[t].entity=n,!this._config.buttons[t].icon&&n&&(this._config.buttons[t].icon=s(n)),this._emitDebounced(),this._syncForm()})),d.label="Icon (Optional)",d.value=e.icon||"",d.addEventListener("value-changed",(e=>{e.stopPropagation(),this._config.buttons[t].icon=(e.detail.value||"").trim(),this._emitDebounced()})),i.appendChild(l),i.appendChild(c),o.appendChild(d),this._buttonElements.push({entity:l,icon:d}),r.addEventListener("click",(()=>{t<1||(this._config.buttons.splice(t,1),this._buildButtonListDOM(),this._emitDebounced())})),n.addEventListener("dragstart",(e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t)),setTimeout((()=>n.classList.add("dragging")),0)})),n.addEventListener("dragend",(()=>{n.classList.remove("dragging"),this._els.buttonsWrap.querySelectorAll(".drag-over").forEach((e=>e.classList.remove("drag-over")))})),n.addEventListener("dragover",(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",n.classList.add("drag-over")})),n.addEventListener("dragleave",(()=>{n.classList.remove("drag-over")})),n.addEventListener("drop",(e=>{e.preventDefault(),n.classList.remove("drag-over");const t=parseInt(e.dataTransfer.getData("text/plain"),10),i=parseInt(n.dataset.idx,10);if(!isNaN(t)&&t!==i){const[e]=this._config.buttons.splice(t,1);this._config.buttons.splice(i,0,e),this._buildButtonListDOM(),this._emitDebounced()}}));let h=null;a.addEventListener("touchstart",(e=>{e.stopPropagation(),h=n,n.classList.add("dragging")}),{passive:!0}),a.addEventListener("touchmove",(e=>{if(!h)return;e.preventDefault();const t=e.touches[0],n=this.shadowRoot.elementsFromPoint(t.clientX,t.clientY).find((e=>e.classList&&e.classList.contains("list-item")));this._els.buttonsWrap.querySelectorAll(".drag-over").forEach((e=>e.classList.remove("drag-over"))),n&&n!==h&&n.classList.add("drag-over")}),{passive:!1}),a.addEventListener("touchend",(e=>{if(!h)return;e.stopPropagation(),h.classList.remove("dragging");const t=e.changedTouches[0],n=this.shadowRoot.elementsFromPoint(t.clientX,t.clientY).find((e=>e.classList&&e.classList.contains("list-item")));if(this._els.buttonsWrap.querySelectorAll(".drag-over").forEach((e=>e.classList.remove("drag-over"))),n&&n!==h){const e=parseInt(h.dataset.idx,10),t=parseInt(n.dataset.idx,10);if(!isNaN(e)&&!isNaN(t)&&e!==t){const[n]=this._config.buttons.splice(e,1);this._config.buttons.splice(t,0,n),this._buildButtonListDOM(),this._emitDebounced()}}h=null})),this._els.buttonsWrap.appendChild(n)}))}_emitDebounced(){this._emitTimer&&clearTimeout(this._emitTimer),this._emitTimer=setTimeout((()=>{const t={type:`custom:${e}`,name:(this._config.name??"").trim(),icon:(this._config.icon??"mdi:home").trim(),temp_entity:(this._config.temp_entity??"").trim(),humidity_entity:(this._config.humidity_entity??"").trim(),window_entity:(this._config.window_entity??"").trim(),nav_path:(this._config.nav_path??"").trim(),cover_invert:!!this._config.cover_invert,dark_text:!!this._config.dark_text,show_door_closed:!!this._config.show_door_closed,color_on:(this._config.color_on??"").trim(),color_on_dark:(this._config.color_on_dark??"").trim(),color_cover:(this._config.color_cover??"").trim(),color_cover_dark:(this._config.color_cover_dark??"").trim(),color_door_open:(this._config.color_door_open??"").trim(),color_door_open_dark:(this._config.color_door_open_dark??"").trim(),color_door_closed:(this._config.color_door_closed??"").trim(),color_door_closed_dark:(this._config.color_door_closed_dark??"").trim(),max_buttons:n(this._config.max_buttons??4,1,4),buttons:(this._config.buttons||[]).map((e=>{const t={...e};return delete t._service_data_json,t.icon||delete t.icon,t.nav_path||delete t.nav_path,t.service||delete t.service,t.service_data||delete t.service_data,t}))};r(this,"config-changed",{config:t})}),100)}}customElements.get(e)||customElements.define(e,c),customElements.get(t)||customElements.define(t,d),window.customCards=window.customCards||[],window.customCards.some((t=>t.type===e))||window.customCards.push({type:e,name:"Smarvy Area Card",description:"Premium Area card with Glassmorphism, Pop-up and Progress Veil."})})();