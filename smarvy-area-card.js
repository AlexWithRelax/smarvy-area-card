(()=>{const e="smarvy-area-card",t=`${e}-editor`,i=["light","switch","fan","input_boolean"],n=(e,t,i)=>Math.max(t,Math.min(i,e)),o=e=>e?String(e).split(".")[0]:"",s=(e,t)=>e?.states?.[t]??null,a=(e,t,i={})=>{e.dispatchEvent(new CustomEvent(t,{detail:i,bubbles:!0,composed:!0}))},r=e=>{const t=o(e);return"light"===t?"mdi:lightbulb":"switch"===t?"mdi:power-socket-de":"fan"===t?"mdi:fan":"input_boolean"===t?"mdi:toggle-switch":"cover"===t?"mdi:window-shutter":"mdi:flash"},l=(e,t)=>{const i=s(e,t);return i?.attributes?.friendly_name||t||""},c=(e,{keepEmptyButtons:t=!1}={})=>{const i={...e||{}};return i.name=i.name??"",i.icon=i.icon??"mdi:home",i.temp_entity=i.temp_entity??"",i.humidity_entity=i.humidity_entity??"",i.window_entity=(i.window_entity??"").trim(),i.climate_entity=(i.climate_entity??"").trim(),i.nav_path=(i.nav_path??"").trim(),i.cover_invert=!!i.cover_invert,i.dark_text=!!i.dark_text,i.show_door_closed=!!i.show_door_closed,i.color_door_open=(i.color_door_open??"").trim(),i.color_door_open_dark=(i.color_door_open_dark??"").trim(),i.color_door_closed=(i.color_door_closed??"").trim(),i.color_door_closed_dark=(i.color_door_closed_dark??"").trim(),i.color_on=(i.color_on??"").trim(),i.color_cover=(i.color_cover??"").trim(),i.color_on_dark=(i.color_on_dark??"").trim(),i.color_cover_dark=(i.color_cover_dark??"").trim(),i.max_buttons=Number.isFinite(Number(i.max_buttons))?Number(i.max_buttons):4,i.max_buttons=n(i.max_buttons,1,4),i.buttons=Array.isArray(i.buttons)?i.buttons:[],i.buttons=i.buttons.map((e=>({entity:(e?.entity??"").trim(),icon:(e?.icon??"").trim(),type:((e?.type??"entity")+"").trim().toLowerCase(),nav_path:(e?.nav_path??"").trim(),service:(e?.service??"").trim(),service_data:e?.service_data&&"object"==typeof e.service_data?e.service_data:void 0}))),t||(i.buttons=i.buttons.filter((e=>"entity"!==(e.type||"entity")||""!==(e.entity||"").trim()))),i};class d extends HTMLElement{_coverDir={};_popupOpen=!1;_popupMode="overflow";_built=!1;_hasRenderedOnce=!1;_lastStates={};_renderRaf=null;_trackedEntities=[];_miniNodes=[];_popupMiniNodes=[];_popupLabels=[];_nudge={x:-2,y:-1,yBadge:-4,coverY:-1,coverYBadge:-5};_badges={temp:{},climate:{}};_coverDebounce=0;_handleWindowKeydown=e=>{"Escape"===e.key&&this._popupOpen&&this._closePopup()};connectedCallback(){window.addEventListener("keydown",this._handleWindowKeydown)}disconnectedCallback(){window.removeEventListener("keydown",this._handleWindowKeydown),this._resizeObs&&this._resizeObs.disconnect()}static getStubConfig(){return{type:`custom:${e}`,name:"",icon:"mdi:home",temp_entity:"",humidity_entity:"",window_entity:"",climate_entity:"",nav_path:"/home/areas",cover_invert:!0,dark_text:!1,max_buttons:4,buttons:[{entity:"",icon:"",type:"entity"}]}}static getConfigElement(){return document.createElement(t)}setConfig(e){if(!e)throw new Error("No config provided");this._config=c(e,{keepEmptyButtons:!0}),this._config.dark_text?this.classList.add("dark-text"):this.classList.remove("dark-text"),this._ensureBuilt();const t=(e,t)=>{t?this.style.setProperty(e,t):this.style.removeProperty(e)};t("--config-color-on",this._config.color_on),t("--config-color-cover",this._config.color_cover),t("--config-color-on-dark",this._config.color_on_dark),t("--config-color-cover-dark",this._config.color_cover_dark),this._renderStatic(),this._lastStates={},this._hasRenderedOnce=!1,this._updatePreviewBackground(),this._hass&&(this._renderDynamic(),this._renderPopupDynamic())}set hass(e){if(this._hass=e,!this._config||!this._built)return;let t=!1;for(const i of this._trackedEntities)e.states[i]!==this._lastStates[i]&&(t=!0,this._lastStates[i]=e.states[i]);!t&&this._hasRenderedOnce||(this._hasRenderedOnce=!0,this._renderRaf&&cancelAnimationFrame(this._renderRaf),this._renderRaf=requestAnimationFrame((()=>{this._renderDynamic(),this._popupOpen&&this._renderPopupDynamic()})))}_updatePreviewBackground(){setTimeout((()=>{let e=this.parentElement;e&&"hui-card-preview"!==e.localName&&e.getRootNode&&(e=e.getRootNode().host),e&&"hui-card-preview"===e.localName&&(this._config.dark_text?(e.style.background="linear-gradient(135deg, #d6e8ff 0%, #b8d4ff 100%)",e.style.padding="24px",e.style.borderRadius="16px",e.style.boxShadow="inset 0 0 20px rgba(255,255,255,0.5)"):(e.style.background="",e.style.padding="",e.style.borderRadius="",e.style.boxShadow=""))}),50)}getCardSize(){return 1}_coverPos(e){const t=e?.attributes?.current_position;if("number"!=typeof t)return null;const i=n(t,0,100);return this._config?.cover_invert?100-i:i}_isCoverMoving(e){const t=String(e?.state??"").toLowerCase();return"opening"===t||"closing"===t}_canMasterOff(){return(this._allButtons||[]).some((e=>{const t=(e.entity||"").trim();if(!t)return!1;const n=s(this._hass,t),a=o(t);return n&&i.includes(a)&&"on"===String(n.state).toLowerCase()}))}_handleMasterOff(){let e=!1;(this._allButtons||[]).forEach((t=>{const n=(t.entity||"").trim();if(!n)return;const a=s(this._hass,n),r=o(n);a&&i.includes(r)&&"on"===String(a.state).toLowerCase()&&(this._hass.callService("homeassistant","turn_off",{entity_id:n}),e=!0)})),e&&a(this,"haptic","heavy")}_buildBadgeDOM(e){const t={};return t.container=document.createElement("div"),t.container.className=e?"climate-popup-badge":"temp-badge",t.container.style.display="none",t.window=document.createElement("span"),t.window.className="badge-part window-part",t.window.style.display="none",t.window.style.alignItems="center",t.window.style.fontWeight="bold",t.windowIcon=document.createElement("ha-icon"),t.windowIcon.className="window-icon",t.windowIcon.style.marginRight=e?"4px":"calc(3px * var(--badge-scale, 1))",e&&t.windowIcon.style.setProperty("--mdc-icon-size","16px"),t.windowText=document.createElement("span"),t.windowText.className="window-text",t.window.append(t.windowIcon,t.windowText),t.sep1=document.createElement("span"),t.sep1.className="badge-sep",t.sep1.textContent="|",t.sep1.style.display="none",e&&(t.sep1.style.cssText="opacity:0.35; margin:0 6px; font-weight:normal;"),t.temp=document.createElement("span"),t.temp.className="badge-part temp-part",t.temp.style.display="none",t.temp.style.alignItems="center",t.tempIcon=document.createElement("ha-icon"),t.tempIcon.setAttribute("icon","mdi:thermometer"),t.tempIcon.style.marginRight=e?"4px":"calc(2px * var(--badge-scale, 1))",e&&t.tempIcon.style.setProperty("--mdc-icon-size","16px"),t.tempText=document.createTextNode(""),t.temp.append(t.tempIcon,t.tempText),t.sep2=document.createElement("span"),t.sep2.className="badge-sep hum-sep",t.sep2.textContent="|",t.sep2.style.display="none",e&&(t.sep2.style.cssText="opacity:0.35; margin:0 6px; font-weight:normal;"),t.hum=document.createElement("span"),t.hum.className="badge-part hum-part",t.hum.style.display="none",t.hum.style.alignItems="center",t.humIcon=document.createElement("ha-icon"),t.humIcon.setAttribute("icon","mdi:water-percent"),t.humIcon.style.marginRight=e?"4px":"calc(2px * var(--badge-scale, 1))",e&&t.humIcon.style.setProperty("--mdc-icon-size","16px"),t.humText=document.createTextNode(""),t.hum.append(t.humIcon,t.humText),t.container.append(t.window,t.sep1,t.temp,t.sep2,t.hum),t}_ensureBuilt(){if(this._built)return;this._built=!0,this.attachShadow({mode:"open"});const e=document.createElement("style");e.textContent='\n    * { box-sizing: border-box; }\n\n    :host {\n      --smarvy-text-color: var(--primary-text-color);\n      --smarvy-theme-bg: var(--card-background-color, var(--primary-background-color, #ffffff));\n      \n      --smarvy-on: var(--config-color-on, var(--state-icon-active-color, #fdd835));\n      --smarvy-cover-on: var(--config-color-cover, #34c759);\n      \n      --smarvy-glass-bg: color-mix(in srgb, var(--smarvy-theme-bg) 30%, transparent);\n      --smarvy-glass-hover: color-mix(in srgb, var(--smarvy-theme-bg) 40%, transparent);\n      --smarvy-glass-btn: transparent;\n      --smarvy-glass-btn-hover: color-mix(in srgb, var(--smarvy-text-color) 6%, transparent);\n      --smarvy-border: color-mix(in srgb, var(--smarvy-text-color) 12%, transparent);\n      --smarvy-icon-inactive: color-mix(in srgb, var(--smarvy-text-color) 60%, transparent);\n\n      --smarvy-glass-edge: rgba(255, 255, 255, 0.15);\n      --smarvy-glass-shimmer: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0) 35%);\n      --smarvy-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);\n      \n      --smarvy-active-btn-bg: color-mix(in srgb, var(--smarvy-on) 15%, transparent);\n      --smarvy-active-cover-bg: color-mix(in srgb, var(--smarvy-cover-on) 15%, transparent);\n      --smarvy-active-card-bg: linear-gradient(135deg, color-mix(in srgb, var(--smarvy-glass-bg) 85%, var(--smarvy-on)), var(--smarvy-glass-bg) 100%);\n      --smarvy-main-icon-active: var(--smarvy-on);\n      \n      --smarvy-on-glow: 0 0 15px color-mix(in srgb, var(--smarvy-on) 15%, transparent);\n      --smarvy-cover-glow: 0 0 15px color-mix(in srgb, var(--smarvy-cover-on) 15%, transparent);\n\n      --smarvy-veil-color: rgba(255, 255, 255, 0.25);\n    }\n    \n    :host(.dark-text) {\n      --smarvy-text-color: #1c1c1e;\n      --smarvy-theme-bg: #ffffff;\n      \n      --smarvy-on: var(--config-color-on-dark, #cc8d14); \n      --smarvy-cover-on: var(--config-color-cover-dark, #305e3b);\n      \n      --smarvy-glass-bg: color-mix(in srgb, var(--smarvy-theme-bg) 20%, transparent);\n      --smarvy-border: color-mix(in srgb, var(--smarvy-text-color) 20%, transparent);\n\n      --smarvy-glass-edge: rgba(255, 255, 255, 0.5); \n      --smarvy-glass-shimmer: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0) 40%);\n      --smarvy-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);\n      \n      --smarvy-active-btn-bg: rgba(255, 255, 255, 0.95);\n      --smarvy-active-cover-bg: rgba(255, 255, 255, 0.95);\n      \n      --smarvy-active-card-bg: linear-gradient(135deg, color-mix(in srgb, var(--smarvy-glass-bg) 85%, var(--smarvy-on)), var(--smarvy-glass-bg) 100%);\n      --smarvy-main-icon-active: var(--smarvy-text-color); \n      \n      --smarvy-on-glow: 0 4px 12px color-mix(in srgb, var(--smarvy-on) 20%, transparent);\n      --smarvy-cover-glow: 0 4px 12px color-mix(in srgb, var(--smarvy-cover-on) 20%, transparent);\n      --smarvy-veil-color: rgba(44, 44, 46, 0.3);\n    }\n\n    ha-card { \n      border-radius: 20px; padding: 16px; position: relative;\n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-bg);\n      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);\n      border: 1px solid var(--smarvy-border);\n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), var(--smarvy-shadow);\n      transform: translateZ(0); \n      transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.3s ease, background 0.3s ease, border-color 0.3s ease;\n    }\n    ha-card.card-is-active {\n      background: var(--smarvy-glass-shimmer), var(--smarvy-active-card-bg);\n      border-color: color-mix(in srgb, var(--smarvy-border) 70%, var(--smarvy-on));\n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), var(--smarvy-shadow);\n    }\n\n    .row { display: flex; align-items: center; gap: 12px; min-height: 48px; }\n    \n    .main-button {\n      position: relative; width: 48px; height: 58px; border-radius: 16px;\n      margin: -5px 0 -5px -6px; z-index: 3;\n      display: flex; align-items: center; justify-content: center; flex-shrink: 0;\n      cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation;\n      -webkit-touch-callout: none; -webkit-user-select: none;\n      overflow: hidden;\n      background: color-mix(in srgb, var(--smarvy-glass-btn) 10%, transparent); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border);\n      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.3s ease, box-shadow 0.3s ease;\n    }\n    .main-button:hover { background: color-mix(in srgb, var(--smarvy-glass-btn-hover) 50%, transparent); }\n    .main-button.is-touch.long-pressing {\n      transform: scale(1.15) !important; z-index: 50;\n      box-shadow: 0 20px 40px rgba(0,0,0,0.25), inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border) !important;\n      transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), box-shadow 0.6s ease-out !important;\n    }\n    .main-button .veil {\n      position: absolute; top: 0; left: 0; height: 100%; width: 0%;\n      background: var(--smarvy-veil-color); pointer-events: none; z-index: 1; transition: width 0.3s ease-out;\n    }\n    .main-button.long-pressing .veil { transition: width 0.6s linear; width: 100%; }\n    .main-button.no-transition .veil { transition: none !important; width: 0 !important; }\n    .main-icon { position: relative; z-index: 2; width: 26px; height: 26px; color: var(--smarvy-text-color); opacity: 0.9; transition: color 0.3s ease; transform: translate(1px, 0px); }\n\n    .middle-hitbox {\n      position: relative; flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;\n      min-width: 0; border-radius: 12px; margin: -5px 0; padding: 5px 0; z-index: 2;\n      cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation;\n      overflow: hidden; \n    }\n    .middle-hitbox .veil {\n      position: absolute; top: 0; left: 0; height: 100%; width: 0%;\n      background: linear-gradient(to right, transparent 0%, var(--smarvy-veil-color) 25%, var(--smarvy-veil-color) 100%);\n      pointer-events: none; z-index: 1; transition: width 0.3s ease-out;\n    }\n    .middle-hitbox.long-pressing .veil { transition: width 0.6s linear; width: 100%; }\n    .middle-hitbox.no-transition .veil { transition: none !important; width: 0 !important; }\n\n    .name-wrap { position: relative; z-index: 2; display: flex; flex-direction: column; width: 100%; align-items: center; justify-content: center; }\n    .name { color: var(--smarvy-text-color); font-size: 18px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; width: 100%; text-align: center; pointer-events: none; }\n    \n    .temp-badge { \n      --badge-scale: 1;\n      display: inline-flex; align-items: center; gap: calc(2px * var(--badge-scale)); pointer-events: none;\n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); \n      padding: calc(3px * var(--badge-scale)) calc(8px * var(--badge-scale)); \n      border-radius: calc(12px * var(--badge-scale)); \n      font-size: calc(11px * var(--badge-scale)); font-weight: 600; margin-top: 6px; \n      color: var(--smarvy-text-color); opacity: 0.85; transition: background 0.2s ease, box-shadow 0.2s ease; \n      white-space: nowrap; \n    }\n    .temp-badge ha-icon {\n      --mdc-icon-size: calc(14px * var(--badge-scale)) !important;\n    }\n    .badge-sep { opacity: 0.35; margin: 0 calc(4px * var(--badge-scale)); font-weight: normal; }\n    .badge-part { display: flex; align-items: center; }\n    \n    .btns { display: flex; gap: 8px; flex: 0 0 192px; justify-content: flex-end; align-items: center; z-index: 3; position: relative; }\n    \n    .mini { \n      position: relative; width: 42px; height: 42px; border-radius: 16px; display: grid; place-items: center; cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation;\n      overflow: hidden; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); \n      color: var(--smarvy-icon-inactive); \n      --smarvy-glow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); \n      box-shadow: var(--smarvy-glow); \n      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease, color 0.2s ease; \n    }\n    .mini:hover { \n      transform: translateY(-2px) scale(1.05); \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn-hover); \n      box-shadow: var(--smarvy-glow), 0 4px 12px rgba(0,0,0,0.05); \n    }\n    .mini:active { transform: scale(0.95); }\n    \n    .mini.is-touch.long-pressing {\n      transform: scale(1.45) !important; z-index: 50;\n      box-shadow: 0 20px 40px rgba(0,0,0,0.25), var(--smarvy-glow) !important;\n      transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), box-shadow 0.6s ease-out !important;\n    }\n\n    .mini .veil {\n      position: absolute; top: 0; left: 0; height: 100%; width: 0%;\n      background: var(--smarvy-veil-color); pointer-events: none; z-index: 1; transition: width 0.3s ease-out; \n    }\n    .mini.long-pressing .veil { transition: width 0.6s linear; width: 100%; }\n    .mini.no-transition .veil { transition: none !important; width: 0 !important; }\n\n    .mini ha-icon, .iconWrap, .spinner-track, .badge { position: relative; z-index: 2; }\n    \n    .mini.is-on { \n      background: var(--smarvy-active-btn-bg) !important; color: var(--smarvy-on) !important; \n      --smarvy-glow: inset 0 0 0 1px color-mix(in srgb, var(--smarvy-on) 40%, transparent), var(--smarvy-on-glow) !important; box-shadow: var(--smarvy-glow) !important; \n    }\n    .mini.is-on-cover, .mini.is-moving { \n      background: var(--smarvy-active-cover-bg) !important; color: var(--smarvy-cover-on) !important; \n      --smarvy-glow: inset 0 0 0 1px color-mix(in srgb, var(--smarvy-cover-on) 40%, transparent), var(--smarvy-cover-glow) !important; box-shadow: var(--smarvy-glow) !important; \n    }\n\n    .mini .iconWrap { position: absolute; inset: 0; display: grid; place-items: center; line-height: 0; pointer-events: none; }\n    @keyframes smarvySpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }\n    .mini.is-spinning .iconWrap { animation: smarvySpin 1.5s linear infinite; }\n    .mini ha-icon { width: 20px; height: 20px; display: block; color: currentColor; transform: translate(var(--icon-nudge-x, 0px), var(--icon-nudge-y, -1px)); }\n    .mini.has-badge ha-icon { transform: translate(var(--icon-nudge-x, 0px), var(--icon-nudge-y-badge, -4px)); }\n    @keyframes squircleSpinCw { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n    @keyframes squircleSpinCcw { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }\n    .spinner-track { position: absolute; inset: 0; border-radius: inherit; overflow: hidden; padding: 1.5px; -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude; pointer-events: none; opacity: 0; transition: opacity 0.3s ease; }\n    .mini.is-moving .spinner-track { opacity: 1; }\n    .spinner-track::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; animation-play-state: paused !important; }\n    .mini.is-moving .spinner-track::before { animation-play-state: running !important; }\n    .mini[data-last-dir="down"] .spinner-track::before { background: conic-gradient(transparent 30%, var(--smarvy-cover-on) 100%); animation: squircleSpinCw 3s linear infinite; }\n    .mini[data-last-dir="up"] .spinner-track::before { background: conic-gradient(var(--smarvy-cover-on) 0%, transparent 70%); animation: squircleSpinCcw 3s linear infinite; }\n    .mini[aria-disabled="true"] { opacity: 0.45; cursor: not-allowed; }\n    .badge { position: absolute; left: 0; right: 0; bottom: 3px; text-align: center; font-size: 10px; line-height: 10px; font-weight: 600; opacity: 0.9; pointer-events: none; color: currentColor; display: none; }\n    \n    @media (max-width: 450px) { .btns { flex: 0 0 142px; } }\n    @media (max-width: 420px) { \n      .window-text { display: none !important; } \n      .window-icon { margin-right: 0 !important; } \n      \n      .temp-badge.has-window .hum-part, \n      .temp-badge.has-window .hum-sep { display: none !important; }\n    }\n    @media (max-width: 380px) { \n      .mini { width: 36px; height: 36px; border-radius: 12px; } .mini ha-icon { width: 18px; height: 18px; } .btns { gap: 6px; flex: 0 0 120px; } \n      .name { font-size: 16px; } ha-card { padding: 12px; } .main-button { width: 44px; height: 50px; border-radius: 12px; margin: -4px 0 -4px -4px; } .main-icon { width: 22px; height: 22px; }\n    }\n    \n    /* Pop-Up Design */\n    .overlay { \n      position: fixed; inset: 0; background: rgba(0,0,0,0); visibility: hidden; z-index: 1; pointer-events: none; transition: visibility 0s linear 0.3s, background 0.3s ease; \n    }\n    .overlay.open { visibility: visible; pointer-events: auto; background: rgba(0,0,0,0.45); transition: visibility 0s linear 0s, background 0.3s ease; }\n    \n    .dialog { \n      position: absolute; left: 50%; top: 50%; transform: translate3d(-50%, -50%, 0); opacity: 0; \n      width: min(620px, calc(100vw - 40px)); border-radius: 24px; overflow: hidden; touch-action: pan-y; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-bg); border: 1px solid var(--smarvy-border); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), 0 24px 48px rgba(0,0,0,0.3); \n      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); will-change: opacity, transform; \n      transition: opacity 0.3s ease, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); \n    }\n    \n    .overlay.open .dialog { opacity: 1; }\n    .dialog.is-swiping { transition: none !important; }\n    \n    .dialog-inner { padding: 20px; max-height: min(75vh, 640px); overflow-y: auto; opacity: 0; transition: opacity 0.3s ease; overscroll-behavior: contain; -webkit-overflow-scrolling: touch; }\n    .overlay.open .dialog-inner { opacity: 1; }\n    \n    .swipe-handle { width: 40px; height: 5px; background: color-mix(in srgb, var(--smarvy-text-color) 25%, transparent); border-radius: 3px; margin: 0 auto 16px auto; display: block; }\n    .dialogHeader { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 20px; padding: 0 4px; }\n    .dialogTitle { color: var(--smarvy-text-color); font-weight: 700; font-size: 18px; opacity: 0.95; }\n    .dialogHint { color: var(--smarvy-text-color); margin-top: 4px; font-size: 13px; opacity: 0.6; }\n    \n    .closeBtn { \n      width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); color: var(--smarvy-text-color); \n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); transition: background 0.2s ease, transform 0.2s ease; \n    }\n    .closeBtn:hover { background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn-hover); transform: scale(1.05); }\n    .closeBtn ha-icon { display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; color: currentColor; }\n    \n    /* Grid (Overflow) */\n    .grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); justify-content: center; justify-items: center; }\n    .cell { \n      width: 100%; max-width: 150px; display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 12px 8px; border-radius: 20px; \n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); \n      opacity: 0; transform: translateY(15px); transition: transform 0.3s ease, opacity 0.3s ease; \n    }\n    .overlay.open .cell { opacity: 1; transform: translateY(0); transition-delay: var(--delay, 0s); }\n    .cellLabel { width: 100%; text-align: center; color: var(--smarvy-text-color); font-size: 12px; font-weight: 500; opacity: 0.85; line-height: 1.2; min-height: 28px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; word-break: break-word; }\n\n    /* Climate Control */\n    .climate-wrap { display: none; flex-direction: column; align-items: center; padding: 10px 0 20px 0; }\n    .climate-wrap.active { display: flex; }\n    .climate-controls { display: flex; align-items: center; justify-content: center; gap: 30px; width: 100%; }\n    .climate-btn {\n      width: 56px; height: 56px; border-radius: 20px; display: grid; place-items: center; cursor: pointer; user-select: none;\n      background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); color: var(--smarvy-text-color);\n      box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); transition: background 0.2s ease, transform 0.2s ease;\n    }\n    .climate-btn:hover { background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn-hover); transform: scale(1.05); }\n    .climate-btn:active { transform: scale(0.95); }\n    .climate-btn ha-icon { \n      width: 28px; height: 28px; \n      pointer-events: none;\n      display: flex; align-items: center; justify-content: center;\n      transform: translateY(1.5px); \n    }\n    \n    .climate-info { \n      position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;\n      padding: 10px 24px; border-radius: 16px; margin: -5px 0;\n      cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation;\n      overflow: hidden; \n    }\n    .climate-info .veil {\n      position: absolute; top: 0; left: 0; height: 100%; width: 0%;\n      background: linear-gradient(to right, transparent 0%, var(--smarvy-veil-color) 25%, var(--smarvy-veil-color) 100%);\n      pointer-events: none; z-index: 1; transition: width 0.3s ease-out;\n    }\n    .climate-info.long-pressing .veil { transition: width 0.6s linear; width: 100%; }\n    .climate-info.no-transition .veil { transition: none !important; width: 0 !important; }\n    \n    .climate-info-inner { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; pointer-events: none; }\n    .climate-target { font-size: 42px; font-weight: 700; color: var(--smarvy-text-color); line-height: 1; margin-bottom: 4px; font-variant-numeric: tabular-nums; }\n    .climate-current { font-size: 14px; font-weight: 500; color: var(--smarvy-text-color); opacity: 0.6; }\n    \n    .climate-popup-badge { display: none; align-items: center; margin-top: 20px; padding: 6px 12px; border-radius: 12px; font-size: 13px; font-weight: 500; color: var(--smarvy-text-color); background: var(--smarvy-glass-shimmer), var(--smarvy-glass-btn); box-shadow: inset 0 1px 1px var(--smarvy-glass-edge), inset 0 0 0 1px var(--smarvy-border); }\n  ',this._cardNode=document.createElement("ha-card");const t=document.createElement("div");t.className="row",this._mainButton=document.createElement("div"),this._mainButton.className="main-button";const i=document.createElement("div");i.className="veil",this._mainButton.appendChild(i),this._mainIcon=document.createElement("ha-icon"),this._mainIcon.className="main-icon",this._mainButton.appendChild(this._mainIcon),this._attachPressHandlers(this._mainButton,{onTap:null,onHold:()=>this._handleMasterOff(),canLongPress:()=>this._canMasterOff()}),this._middleHitbox=document.createElement("div"),this._middleHitbox.className="middle-hitbox";const n=document.createElement("div");n.className="veil",this._middleHitbox.appendChild(n);const o=document.createElement("div");o.className="name-wrap",this._mainName=document.createElement("div"),this._mainName.className="name",this._badges.temp=this._buildBadgeDOM(!1),o.appendChild(this._mainName),o.appendChild(this._badges.temp.container),this._middleHitbox.appendChild(o),this._attachPressHandlers(this._middleHitbox,{onTap:()=>{if(!this._config)return;const e=(this._config.nav_path||"").trim();e&&(window.history.pushState(null,"",e),window.dispatchEvent(new CustomEvent("location-changed")))},onHold:()=>{this._config.climate_entity&&(a(this,"haptic","heavy"),this._openPopup("climate"))},canLongPress:()=>!!this._config.climate_entity}),this._btns=document.createElement("div"),this._btns.className="btns",t.appendChild(this._mainButton),t.appendChild(this._middleHitbox),t.appendChild(this._btns),this._cardNode.appendChild(t),this._overlay=document.createElement("div"),this._overlay.className="overlay",this._overlay.addEventListener("touchmove",(e=>{e.target===this._overlay&&e.preventDefault()}),{passive:!1}),this._overlay.addEventListener("click",(e=>{e.target!==this._overlay||this._blockClose||this._closePopup()}));const s=document.createElement("div");s.className="dialog";const r=document.createElement("div");r.className="dialog-inner";const l=document.createElement("div");l.className="swipe-handle";const c=document.createElement("div");c.className="dialogHeader";const d=document.createElement("div");this._dialogTitle=document.createElement("div"),this._dialogTitle.className="dialogTitle",this._dialogTitle.textContent="Steuerung",this._dialogHint=document.createElement("div"),this._dialogHint.className="dialogHint",this._dialogHint.textContent="Tipp: Halten für Details",d.appendChild(this._dialogTitle),d.appendChild(this._dialogHint);const p=document.createElement("div");p.className="closeBtn";const h=document.createElement("ha-icon");h.setAttribute("icon","mdi:close"),p.appendChild(h),p.addEventListener("click",(e=>{e.stopPropagation(),this._closePopup()})),c.appendChild(d),c.appendChild(p),this._popupGrid=document.createElement("div"),this._popupGrid.className="grid",this._climateWrap=document.createElement("div"),this._climateWrap.className="climate-wrap";const m=document.createElement("div");m.className="climate-controls",this._btnMinus=document.createElement("div"),this._btnMinus.className="climate-btn",this._btnMinus.innerHTML='<ha-icon icon="mdi:minus"></ha-icon>';const u=document.createElement("div");u.className="climate-info";const v=document.createElement("div");v.className="veil",u.appendChild(v);const _=document.createElement("div");_.className="climate-info-inner",this._climateTarget=document.createElement("div"),this._climateTarget.className="climate-target",this._climateTarget.textContent="--°",this._climateCurrent=document.createElement("div"),this._climateCurrent.className="climate-current",this._climateCurrent.textContent="Ist: --°",_.appendChild(this._climateTarget),_.appendChild(this._climateCurrent),u.appendChild(_),this._attachPressHandlers(u,{onTap:null,onHold:()=>{this._config.climate_entity&&(this._applyEventShield(800),a(this,"haptic","heavy"),a(this,"hass-more-info",{entityId:this._config.climate_entity}))},canLongPress:()=>!!this._config.climate_entity}),this._btnPlus=document.createElement("div"),this._btnPlus.className="climate-btn",this._btnPlus.innerHTML='<ha-icon icon="mdi:plus"></ha-icon>',m.appendChild(this._btnMinus),m.appendChild(u),m.appendChild(this._btnPlus),this._badges.climate=this._buildBadgeDOM(!0),this._climateWrap.appendChild(m),this._climateWrap.appendChild(this._badges.climate.container),this._btnMinus.addEventListener("click",(()=>this._adjustTemp(-1))),this._btnPlus.addEventListener("click",(()=>this._adjustTemp(1))),r.appendChild(l),r.appendChild(c),r.appendChild(this._popupGrid),r.appendChild(this._climateWrap),s.appendChild(r),this._overlay.appendChild(s);let g=0,y=!1,b=!1,f=null;s.addEventListener("touchstart",(e=>{g=e.touches[0].clientY,r.scrollTop<=0?(y=!0,b=!1,s.style.transition="none"):y=!1}),{passive:!0}),s.addEventListener("touchmove",(e=>{const t=e.touches[0].clientY-g;if(y&&t>0)return e.preventDefault(),s.classList.add("is-swiping"),t>90&&!b&&(a(this,"haptic","light"),b=!0),f&&cancelAnimationFrame(f),void(f=requestAnimationFrame((()=>{s.style.transform=`translate3d(-50%, calc(-50% + ${.4*t}px), 0)`})));if(e.composedPath().includes(r)){if(r.scrollHeight>r.clientHeight){const i=r.scrollTop<=0,n=r.scrollTop+r.clientHeight>=r.scrollHeight;(i&&t>0||n&&t<0)&&e.preventDefault()}else e.preventDefault()}else e.preventDefault()}),{passive:!1}),s.addEventListener("touchend",(e=>{if(!y)return;y=!1;const t=e.changedTouches[0].clientY-g;s.classList.remove("is-swiping"),f&&cancelAnimationFrame(f),s.style.transition="transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)",s.style.transform="translate3d(-50%, -50%, 0)",t>90&&this._closePopup()}),{passive:!0}),this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(this._cardNode),this.shadowRoot.appendChild(this._overlay),this._resizeObs=new ResizeObserver((()=>{requestAnimationFrame((()=>this._checkBadgeFit()))})),this._resizeObs.observe(this._cardNode)}_checkBadgeFit(){const e=this._badges.temp.container,t=this._middleHitbox;if(!e||!t||"none"===e.style.display)return;e.style.setProperty("--badge-scale","1");const i=t.clientWidth,n=e.scrollWidth;if(n>i-4&&i>20){const t=(i-4)/n;e.style.setProperty("--badge-scale",Math.max(.6,t).toFixed(3))}}_hasActiveHiddenEntities(){return!!this._hiddenButtons&&this._hiddenButtons.some((e=>{const t=(e.entity||"").trim();if(!t)return!1;const n=s(this._hass,t),a=o(t);return n&&i.includes(a)&&"on"===String(n.state).toLowerCase()}))}_applyEventShield(e=800){const t=document.createElement("div");t.style.cssText="position: fixed; inset: 0; z-index: 999999; background: transparent; touch-action: none;";const i=e=>{e.preventDefault(),e.stopPropagation()};["click","pointerup","touchend","mousedown","mouseup"].forEach((e=>{t.addEventListener(e,i,{capture:!0,passive:!1})})),document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),e)}_attachPressHandlers(e,{onTap:t,onHold:i,canLongPress:n}){let o=null,s=null,a=!1,r=!1,l=!1;const c=()=>{o&&clearTimeout(o),s&&clearTimeout(s),o=null,s=null,r?(e.classList.add("no-transition"),e.classList.remove("long-pressing","is-touch"),setTimeout((()=>{e.classList.remove("no-transition")}),100)):e.classList.remove("long-pressing","is-touch"),setTimeout((()=>{a=!1}),100)},d=t=>{t&&"mouse"===t.pointerType&&0!==t.button||n&&!n()||(o&&clearTimeout(o),s&&clearTimeout(s),a=!1,r=!1,o=setTimeout((()=>{l&&e.classList.add("is-touch"),e.classList.add("long-pressing"),a=!0,s=setTimeout((()=>{r=!0,i&&i()}),600)}),250))};e.addEventListener("contextmenu",(e=>e.preventDefault())),e.addEventListener("pointerdown",(t=>{t.pointerType&&(l="touch"===t.pointerType||"pen"===t.pointerType),"true"!==e.getAttribute("aria-disabled")&&d(t)})),e.addEventListener("pointerup",c),e.addEventListener("pointercancel",c),e.addEventListener("pointerleave",c),e.addEventListener("touchstart",(t=>{l=!0,"true"!==e.getAttribute("aria-disabled")&&d(t)}),{passive:!0}),e.addEventListener("touchend",c,{passive:!0}),e.addEventListener("touchcancel",c,{passive:!0}),e.addEventListener("click",(i=>{i.stopPropagation(),"true"===e.getAttribute("aria-disabled")||a||t?.()}))}_openPopup(e="overflow"){this._popupMode=e,this._popupOpen=!0,this._blockClose=!0,this._blockCloseTimer&&clearTimeout(this._blockCloseTimer),this._blockCloseTimer=setTimeout((()=>{this._blockClose=!1}),700),"climate"===e?(this._popupGrid.style.display="none",this._climateWrap.classList.add("active"),this._dialogTitle.textContent="Temperatur",this._dialogHint.textContent=l(this._hass,this._config.climate_entity)||"Thermostat"):(this._popupGrid.style.display="grid",this._climateWrap.classList.remove("active"),this._dialogTitle.textContent="Steuerung",this._dialogHint.textContent="Tipp: Halten für Details"),this._overlay.classList.add("open"),this._renderPopupDynamic()}_closePopup(){this._popupOpen=!1,this._overlay.classList.remove("open")}_adjustTemp(e){if(!this._hass||!this._config.climate_entity)return;const t=s(this._hass,this._config.climate_entity);if(!t||null==t.attributes.temperature)return;const i=t.attributes.target_temp_step||.5,n=t.attributes.temperature+e*i;this._hass.callService("climate","set_temperature",{entity_id:this._config.climate_entity,temperature:n}),this._climateTarget.textContent=`${n.toFixed(1)}°`,a(this,"haptic","light")}_getRenderableButtons(){return(this._config?.buttons||[]).filter((e=>"entity"!==(e.type||"entity")||""!==(e.entity||"").trim()))}_setBadge(e,t){const i=e?._badgeNode;if(!i)return;const n=!(!t||!String(t).trim());i.style.display=n?"block":"none",i.textContent=n?String(t):"",e.classList.toggle("has-badge",n)}_setIconNudge(e,{x:t,y:i,yBadge:n}){e&&(null!=t&&e.style.setProperty("--icon-nudge-x",`${t}px`),null!=i&&e.style.setProperty("--icon-nudge-y",`${i}px`),null!=n&&e.style.setProperty("--icon-nudge-y-badge",`${n}px`))}_handleQuickOff(){const e=this._hiddenButtons||[];let t=!1;e.forEach((e=>{const n=(e.entity||"").trim();if(n){const e=s(this._hass,n),a=o(n);e&&i.includes(a)&&"on"===String(e.state).toLowerCase()&&(this._hass.callService("homeassistant","turn_off",{entity_id:n}),t=!0)}})),t&&a(this,"haptic","heavy")}_createMini(e="normal"){const t=document.createElement("div");t.className="mini ring",t.dataset.kind=e,t.setAttribute("role","button"),t.setAttribute("tabindex","0");const i=document.createElement("div");i.className="veil",t.appendChild(i);const n=document.createElement("div");n.className="spinner-track",t.appendChild(n);const o=document.createElement("div");o.className="iconWrap";const s=document.createElement("ha-icon");o.appendChild(s),t.appendChild(o),t._iconNode=s;const r=document.createElement("div");return r.className="badge",r.style.display="none",t.appendChild(r),t._badgeNode=r,this._attachPressHandlers(t,{onTap:()=>{"overflow"!==t.dataset.kind?t._btnConfig&&this._handleButton(t._btnConfig):this._openPopup("overflow")},onHold:()=>{if("overflow"===t.dataset.kind)this._handleQuickOff();else{const e=(t._btnConfig?.entity||"").trim();e&&("normal"===t.dataset.kind&&this._applyEventShield(800),a(this,"haptic","heavy"),a(this,"hass-more-info",{entityId:e}))}},canLongPress:()=>"overflow"!==t.dataset.kind||this._hasActiveHiddenEntities()}),t}_syncNodes(e,t,i,n,o){const s=i.length+(n?1:0);for(;t.length>s;){const e=t.pop();e.parentNode&&e.parentNode.removeChild(e)}for(;t.length<s;){const i=this._createMini(o);t.push(i),e.appendChild(i)}if(i.forEach(((e,i)=>{t[i].dataset.kind=o,t[i]._btnConfig=e})),n){const e=t[t.length-1];e.dataset.kind="overflow",e._btnConfig=null}}_renderStatic(){if(!this._config)return;this._mainIcon.setAttribute("icon",this._config.icon||"mdi:home"),this._mainName.textContent=this._config.name||"";const e=this._getRenderableButtons(),t=n(this._config.max_buttons||4,1,4),i=e.length>t,o=i?Math.min(t,3):e.length,s=e.slice(0,o);this._syncNodes(this._btns,this._miniNodes,s,i,"normal"),this._rowButtons=s,this._allButtons=e,this._hasOverflow=i,this._hiddenButtons=this._allButtons.slice(this._rowButtons.length),this._renderPopupStatic(),this._trackedEntities=[],this._config.temp_entity&&this._trackedEntities.push(this._config.temp_entity),this._config.humidity_entity&&this._trackedEntities.push(this._config.humidity_entity),this._config.window_entity&&this._trackedEntities.push(this._config.window_entity),this._config.climate_entity&&this._trackedEntities.push(this._config.climate_entity),this._allButtons.forEach((e=>{const t=(e.entity||"").trim();t&&!this._trackedEntities.includes(t)&&this._trackedEntities.push(t)}))}_renderPopupStatic(){if(!this._popupGrid)return;const e=this._allButtons||[];for(;this._popupLabels.length>e.length;){const e=this._popupLabels.pop();e.parentNode&&e.parentNode.parentNode&&e.parentNode.parentNode.removeChild(e.parentNode),this._popupMiniNodes.pop()}for(;this._popupLabels.length<e.length;){const e=document.createElement("div");e.className="cell";const t=document.createElement("div");t.className="cellLabel";const i=this._createMini("popup");this._popupLabels.push(t),this._popupMiniNodes.push(i),e.appendChild(t),e.appendChild(i),this._popupGrid.appendChild(e)}e.forEach(((e,t)=>{this._popupLabels[t].parentNode.style.setProperty("--delay",.04*t+"s"),this._popupLabels[t].textContent=e.entity?l(this._hass,e.entity):`Button ${t+1}`,this._popupMiniNodes[t].dataset.popupIdx=String(t),this._popupMiniNodes[t]._btnConfig=e})),this._popupButtons=e}_updateNodes(e,t){const n="var(--smarvy-icon-inactive)",a="var(--smarvy-on)";e.forEach(((e,l)=>{this._setIconNudge(e,{x:this._nudge.x,y:this._nudge.y,yBadge:this._nudge.yBadge});const c=e.dataset.kind,d=e._iconNode;if("overflow"===c){e.setAttribute("aria-disabled","false");let t=!1;return this._hiddenButtons&&this._hiddenButtons.forEach((e=>{const n=(e.entity||"").trim();if(n){const e=s(this._hass,n),a=o(n);e&&i.includes(a)&&"on"===String(e.state).toLowerCase()&&(t=!0)}})),t?(e.style.color=a,e.classList.add("is-on")):(e.style.color=n,e.classList.remove("is-on")),e.classList.remove("is-spinning","is-on-cover","is-moving"),this._setBadge(e,""),void(d&&d.setAttribute("icon","mdi:dots-horizontal"))}const p=t[l];if(!p)return;const h=(p.type||"entity").toLowerCase(),m=(p.entity||"").trim(),u=m?s(this._hass,m):null,v=o(m);if(e.setAttribute("aria-disabled","entity"===h&&m&&!u?"true":"false"),e.style.color=n,e.classList.remove("is-on","is-spinning","is-on-cover","is-moving"),this._setBadge(e,""),d)if("cover"===v&&u){this._setIconNudge(e,{x:this._nudge.x,y:this._nudge.coverY,yBadge:this._nudge.coverYBadge});const t=this._coverPos(u),i="number"==typeof u.attributes?.current_position?u.attributes.current_position:null,n=this._isCoverMoving(u),o=String(u.state||"").toLowerCase();if(n)e.classList.add("is-on-cover","is-moving"),d.setAttribute("icon","opening"===o?"mdi:arrow-up-bold":"mdi:arrow-down-bold"),e.dataset.lastDir="opening"===o?"up":"down",this._setBadge(e,null!==t?`${Math.round(t)}%`:"");else{const n=null!==i?i>=99:"open"===o;d.setAttribute("icon",n?"mdi:window-shutter-open":"mdi:window-shutter"),this._setBadge(e,null!==t?`${Math.round(t)}%`:"")}}else if(d.setAttribute("icon",p.icon||r(m)),u&&i.includes(v)){const t="on"===String(u.state).toLowerCase();e.classList.toggle("is-on",t),e.style.color=t?a:n,e.classList.toggle("is-spinning","fan"===v&&t)}}))}_updateBadgeUI(e,t,i,n,o=!1){let s=0;const a=this._config.dark_text?this._config.color_door_open_dark||"#7d2424":this._config.color_door_open||"#c23232",r=this._config.dark_text?this._config.color_door_closed_dark||"#397d50":this._config.color_door_closed||"#50de65";let l=!1;if(t){const i="on"===t.state||"open"===t.state,n="off"===t.state||"closed"===t.state;i?(l=!0,e.window.style.display="flex",e.window.style.color=a,e.windowIcon.setAttribute("icon","mdi:window-open-variant"),e.windowText.textContent="Offen",s++):n&&(this._config.show_door_closed||o)?(l=!0,e.window.style.display="flex",e.window.style.color=r,e.windowIcon.setAttribute("icon","mdi:door-sliding-lock"),e.windowText.textContent="Zu",s++):e.window.style.display="none"}else e.window.style.display="none";i?(s>0?(e.sep1.style.display="inline",s++):e.sep1.style.display="none",e.temp.style.display="flex",e.tempText.textContent=`${i.state}${i.attributes.unit_of_measurement||""}`,s++):(e.temp.style.display="none",e.sep1.style.display="none"),n?(s>0?(e.sep2.style.display="inline",s++):e.sep2.style.display="none",e.hum.style.display="flex",e.humIcon.style.marginLeft=s>1?e.container.classList.contains("climate-popup-badge")?"4px":"calc(4px * var(--badge-scale, 1))":"0px",e.humText.textContent=`${n.state}${n.attributes.unit_of_measurement||""}`,s++):(e.hum.style.display="none",e.sep2.style.display="none"),s>0?(e.container.style.display="inline-flex",e.container.classList.toggle("has-window",l)):(e.container.style.display="none",e.container.classList.remove("has-window"))}_renderDynamic(){if(!this._hass||!this._btns)return;const e=this._config.temp_entity?s(this._hass,this._config.temp_entity):null,t=this._config.humidity_entity?s(this._hass,this._config.humidity_entity):null,n=this._config.window_entity?s(this._hass,this._config.window_entity):null;this._updateBadgeUI(this._badges.temp,n,e,t,!1),this._updateNodes(this._miniNodes,this._rowButtons);let a=!1;(this._allButtons||[]).forEach((e=>{const t=(e.entity||"").trim();if(!t)return;const n=o(t),r=s(this._hass,t);r&&i.includes(n)&&"on"===String(r.state).toLowerCase()&&(a=!0)})),a?(this._cardNode.classList.add("card-is-active"),this._mainIcon.style.color="var(--smarvy-main-icon-active)"):(this._cardNode.classList.remove("card-is-active"),this._mainIcon.style.color="var(--smarvy-text-color)"),requestAnimationFrame((()=>this._checkBadgeFit()))}_renderPopupDynamic(){if(this._popupOpen&&this._hass)if("overflow"===this._popupMode)this._updateNodes(this._popupMiniNodes,this._popupButtons),this._popupLabels.forEach(((e,t)=>{const i=this._popupButtons[t];i&&i.entity&&(e.textContent=l(this._hass,i.entity))}));else if("climate"===this._popupMode&&this._config.climate_entity){const e=s(this._hass,this._config.climate_entity);if(e){const t=e.attributes.temperature,i=e.attributes.current_temperature;this._climateTarget.textContent=null!=t?`${t.toFixed(1)}°`:"--°",this._climateCurrent.textContent=null!=i?`Ist: ${i.toFixed(1)}°`:"Ist: --°"}const t=this._config.humidity_entity?s(this._hass,this._config.humidity_entity):null,i=this._config.window_entity?s(this._hass,this._config.window_entity):null;this._updateBadgeUI(this._badges.climate,i,null,t,!0)}}_handleButton(e){const t=this._hass;if(!t)return;const n=(e.type||"entity").toLowerCase();if("navigate"===n){const t=(e.nav_path||"").trim();return void(t&&a(this,"hass-navigate",{navigation_path:t}))}if("more-info"===n){const t=(e.entity||"").trim();return void(t&&a(this,"hass-more-info",{entityId:t}))}if("service"===n){const i=(e.service||"").trim(),[n,o]=i.split(".");if(!n||!o)return;const s={...e.service_data||{}};return e.entity&&null==s.entity_id&&(s.entity_id=e.entity),void t.callService(n,o,s)}const r=(e.entity||"").trim();if(!r)return;const l=s(t,r);if(!l)return;const c=o(r);if("cover"===c){if(this._coverDebounce&&Date.now()-this._coverDebounce<300)return;this._coverDebounce=Date.now();const e=String(l.state||"").toLowerCase(),i="number"==typeof l.attributes?.current_position?l.attributes.current_position:null;if("opening"===e||"closing"===e)return this._coverDir[r]="opening"===e?"open":"close",void t.callService("cover","stop_cover",{entity_id:r});if(null!==i&&i<=0)return this._coverDir[r]="open",void t.callService("cover","open_cover",{entity_id:r});if(null!==i&&i>=99)return this._coverDir[r]="close",void t.callService("cover","close_cover",{entity_id:r});if("closed"===e)return this._coverDir[r]="open",void t.callService("cover","open_cover",{entity_id:r});if("open"===e&&null===i)return this._coverDir[r]="close",void t.callService("cover","close_cover",{entity_id:r});const n="open"===this._coverDir[r]?"close":"open";return this._coverDir[r]=n,void t.callService("cover","open"===n?"open_cover":"close_cover",{entity_id:r})}i.includes(c)?t.callService("homeassistant","toggle",{entity_id:r}):a(this,"hass-more-info",{entityId:r})}}class p extends HTMLElement{_built=!1;_emitTimer=null;_buttonElements=[];set hass(e){this._hass=e,this._els&&(this._els.tempPicker.hass=e,this._els.humidityPicker.hass=e,this._els.windowPicker.hass=e,this._els.climatePicker.hass=e,this._buttonElements.forEach((t=>{t.entity&&(t.entity.hass=e)})))}setConfig(e){for(this._config=c(e,{keepEmptyButtons:!0});this._config.buttons.length<1;)this._config.buttons.push({entity:"",icon:"",type:"entity"});this._ensureBuilt(),this._syncForm()}_ensureBuilt(){if(this._built)return;this._built=!0,this.attachShadow({mode:"open"}),this.shadowRoot.addEventListener("click",(e=>e.stopPropagation())),this.shadowRoot.addEventListener("pointerdown",(e=>e.stopPropagation()));const e=document.createElement("style");e.textContent="\n    .card-config { display: flex; flex-direction: column; gap: 16px; }\n    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }\n    h3.section-title { font-family: var(--paper-font-body1_-_font-family, Roboto, sans-serif); font-size: 16px; font-weight: 500; color: var(--secondary-text-color); margin: 0 0 12px 0; border-bottom: 1px solid var(--divider-color, rgba(120, 120, 120, 0.2)); padding-bottom: 8px; }\n    .switch-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; }\n    .switch-row span { font-family: var(--paper-font-body1_-_font-family, Roboto, sans-serif); color: var(--primary-text-color); }\n    .switch-row ha-switch { margin-left: 16px; }\n    .color-wrap { display: flex; align-items: center; gap: 8px; }\n    .color-wrap ha-textfield, .color-wrap ha-selector { flex: 1; min-width: 0; }\n    .list-container { display: flex; flex-direction: column; gap: 12px; }\n    \n    .list-item { \n        display: flex; align-items: center; gap: 8px; padding: 12px; \n        border: 1px solid var(--divider-color, rgba(120, 120, 120, 0.2)); border-radius: var(--ha-card-border-radius, 12px); \n        background: var(--card-background-color, transparent); transition: border-color 0.2s, opacity 0.2s, box-shadow 0.2s; \n    }\n    .list-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.05); }\n    .list-item.drag-over { border-color: var(--primary-color); border-width: 2px; }\n    .list-item.dragging { opacity: 0.4; }\n    .handle { cursor: grab; color: var(--secondary-text-color); padding: 4px; display: flex; align-items: center; }\n    .handle:active { cursor: grabbing; }\n    .item-content { flex: 1; display: grid; grid-template-columns: minmax(0, 1fr) 80px; gap: 40px; align-items: center; }\n    .entity-wrap { display: flex; align-items: center; gap: 4px; width: 100%; min-width: 0; }\n    .entity-wrap ha-selector { flex: 1; width: 100%; }\n    .icon-wrap { display: flex; align-items: center; width: 100%; min-width: 0; margin-top: 26px; }\n    .icon-wrap ha-icon-picker { flex: 1; width: 100%; }\n    @media (max-width: 600px) { .item-content { grid-template-columns: 1fr; gap: 8px; } }\n    .icon-btn { color: var(--secondary-text-color); cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 8px; border-radius: 50%; transition: background-color 0.2s, color 0.2s; }\n    .icon-btn:hover { color: var(--error-color, #ff3b30); background-color: rgba(255, 59, 48, 0.1); }\n    .icon-btn.disabled { opacity: 0.3; pointer-events: none; }\n    ha-expansion-panel { border-radius: var(--ha-card-border-radius, 12px); margin-bottom: 0px; }\n    \n    /* Stepper CSS (Touch-Friendly Max Slots) */\n    .stepper-wrap { display: flex; flex-direction: column; justify-content: center; background: var(--secondary-background-color, rgba(120, 120, 120, 0.05)); padding: 8px 16px; border-radius: 4px; border-bottom: 1px solid var(--primary-text-color, #8f8f8f); }\n    .stepper-label { font-size: 12px; color: var(--secondary-text-color); margin-bottom: 8px; font-family: var(--paper-font-body1_-_font-family, Roboto, sans-serif); }\n    .stepper-controls { display: flex; align-items: center; justify-content: space-between; }\n    .stepper-btn { display: grid; place-items: center; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; color: var(--primary-text-color); background: rgba(120, 120, 120, 0.1); transition: background 0.2s; user-select: none; }\n    .stepper-btn:hover { background: rgba(120, 120, 120, 0.2); }\n    .stepper-btn:active { transform: scale(0.9); }\n    .stepper-val { font-size: 16px; font-weight: 500; color: var(--primary-text-color); width: 20px; text-align: center; }\n  ";const t=document.createElement("div");t.className="card-config",t.innerHTML='\n        <ha-expansion-panel header="⚙️ Allgemeine Einstellungen" outlined expanded>\n            <div style="padding: 16px 0 8px 0;">\n                <div class="grid">\n                    <ha-textfield id="name" label="Name (Titel)"></ha-textfield>\n                    <ha-icon-picker id="icon" label="Haupt-Icon"></ha-icon-picker>\n                    <ha-textfield id="navPath" label="Klick-Pfad (z.B. /areas/kueche)"></ha-textfield>\n                    \n                    <div class="stepper-wrap">\n                        <div class="stepper-label">Sichtbare Slots (max. 4)</div>\n                        <div class="stepper-controls">\n                            <div id="btnSlotsMinus" class="stepper-btn"><ha-icon icon="mdi:minus"></ha-icon></div>\n                            <div id="slotsValue" class="stepper-val">4</div>\n                            <div id="btnSlotsPlus" class="stepper-btn"><ha-icon icon="mdi:plus"></ha-icon></div>\n                        </div>\n                    </div>\n\n                </div>\n            </div>\n        </ha-expansion-panel>\n\n        <ha-expansion-panel header="🌡️ Sensoren & Klima" outlined>\n            <div style="padding: 16px 0 8px 0;">\n                <div class="grid">\n                    <div class="color-wrap">\n                        <ha-selector id="tempPicker"></ha-selector>\n                        <div id="clearTemp" class="icon-btn" title="Feld leeren" style="margin-top: 16px;"><ha-icon icon="mdi:close"></ha-icon></div>\n                    </div>\n                    <div class="color-wrap">\n                        <ha-selector id="humidityPicker"></ha-selector>\n                        <div id="clearHumidity" class="icon-btn" title="Feld leeren" style="margin-top: 16px;"><ha-icon icon="mdi:close"></ha-icon></div>\n                    </div>\n                    <div class="color-wrap">\n                        <ha-selector id="windowPicker"></ha-selector>\n                        <div id="clearWindow" class="icon-btn" title="Feld leeren" style="margin-top: 16px;"><ha-icon icon="mdi:close"></ha-icon></div>\n                    </div>\n                    <div class="color-wrap">\n                        <ha-selector id="climatePicker"></ha-selector>\n                        <div id="clearClimate" class="icon-btn" title="Feld leeren" style="margin-top: 16px;"><ha-icon icon="mdi:close"></ha-icon></div>\n                    </div>\n                </div>\n                <div class="switch-row" style="margin-top: 12px;">\n                    <span>Fenster/Tür: Status "Zu" anzeigen (Standard: Nur "offen" wird angezeigt)</span>\n                    <ha-switch id="showDoorClosed"></ha-switch>\n                </div>\n            </div>\n        </ha-expansion-panel>\n\n        <ha-expansion-panel header="🎨 Design & Farben" outlined>\n            <div style="padding: 16px 0 8px 0; display: flex; flex-direction: column; gap: 16px;">\n                <div class="switch-row"><span>Helles Design (Für helle Hintergrundbilder)</span><ha-switch id="darkText"></ha-switch></div>\n                <div class="switch-row"><span>Rollladen invertieren (0% = Offen)</span><ha-switch id="invert"></ha-switch></div>\n                <div style="margin-top: 8px;">\n                    <h3 class="section-title" style="margin-bottom:0;">Farben anpassen</h3>\n                    <p style="font-size:12px; color:var(--secondary-text-color); margin: 0 0 16px 0;">Hex-Codes (z.B. #ff0000). Mit \'X\' leeren für Standardfarbe.</p>\n                    <div class="grid">\n                        <div class="color-wrap"><ha-textfield id="colorOn" label="Geräte (Normal)" placeholder="#fdd835"></ha-textfield><div id="clearColorOn" class="icon-btn"><ha-icon icon="mdi:close"></ha-icon></div></div>\n                        <div class="color-wrap"><ha-textfield id="colorOnDark" label="Geräte (Helles Design)" placeholder="#cc8d14"></ha-textfield><div id="clearColorOnDark" class="icon-btn"><ha-icon icon="mdi:close"></ha-icon></div></div>\n                        <div class="color-wrap"><ha-textfield id="colorCover" label="Rollladen (Normal)" placeholder="#34c759"></ha-textfield><div id="clearColorCover" class="icon-btn"><ha-icon icon="mdi:close"></ha-icon></div></div>\n                        <div class="color-wrap"><ha-textfield id="colorCoverDark" label="Rollladen (Helles Design)" placeholder="#305e3b"></ha-textfield><div id="clearColorCoverDark" class="icon-btn"><ha-icon icon="mdi:close"></ha-icon></div></div>\n                        <div class="color-wrap"><ha-textfield id="colorDoorOpen" label="Tür Offen (Normal)" placeholder="#c23232"></ha-textfield><div id="clearColorDoorOpen" class="icon-btn"><ha-icon icon="mdi:close"></ha-icon></div></div>\n                        <div class="color-wrap"><ha-textfield id="colorDoorOpenDark" label="Tür Offen (Helles Design)" placeholder="#7d2424"></ha-textfield><div id="clearColorDoorOpenDark" class="icon-btn"><ha-icon icon="mdi:close"></ha-icon></div></div>\n                        <div class="color-wrap"><ha-textfield id="colorDoorClosed" label="Tür Zu (Normal)" placeholder="#50de65"></ha-textfield><div id="clearColorDoorClosed" class="icon-btn"><ha-icon icon="mdi:close"></ha-icon></div></div>\n                        <div class="color-wrap"><ha-textfield id="colorDoorClosedDark" label="Tür Zu (Helles Design)" placeholder="#397d50"></ha-textfield><div id="clearColorDoorClosedDark" class="icon-btn"><ha-icon icon="mdi:close"></ha-icon></div></div>\n                    </div>\n                </div>\n            </div>\n        </ha-expansion-panel>\n\n        <ha-expansion-panel header="💡 Geräte & Buttons" outlined>\n            <div style="padding: 16px 0 8px 0;">\n                <div id="buttonsWrap" class="list-container"></div>\n                <ha-button id="addBtn" outlined style="margin-top: 16px;"><ha-icon icon="mdi:plus" slot="icon"></ha-icon>Gerät hinzufügen</ha-button>\n            </div>\n        </ha-expansion-panel>\n      ',this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(t),this._els={name:t.querySelector("#name"),icon:t.querySelector("#icon"),navPath:t.querySelector("#navPath"),btnSlotsMinus:t.querySelector("#btnSlotsMinus"),btnSlotsPlus:t.querySelector("#btnSlotsPlus"),slotsValue:t.querySelector("#slotsValue"),tempPicker:t.querySelector("#tempPicker"),humidityPicker:t.querySelector("#humidityPicker"),windowPicker:t.querySelector("#windowPicker"),climatePicker:t.querySelector("#climatePicker"),showDoorClosed:t.querySelector("#showDoorClosed"),darkText:t.querySelector("#darkText"),invert:t.querySelector("#invert"),colorOn:t.querySelector("#colorOn"),colorOnDark:t.querySelector("#colorOnDark"),colorCover:t.querySelector("#colorCover"),colorCoverDark:t.querySelector("#colorCoverDark"),colorDoorOpen:t.querySelector("#colorDoorOpen"),colorDoorOpenDark:t.querySelector("#colorDoorOpenDark"),colorDoorClosed:t.querySelector("#colorDoorClosed"),colorDoorClosedDark:t.querySelector("#colorDoorClosedDark"),buttonsWrap:t.querySelector("#buttonsWrap"),addBtn:t.querySelector("#addBtn")},this._els.tempPicker.label="Temperatur Sensor",this._els.tempPicker.selector={entity:{domain:["sensor","input_number"]}},this._els.humidityPicker.label="Luftfeuchtigkeit Sensor",this._els.humidityPicker.selector={entity:{domain:["sensor","input_number"]}},this._els.windowPicker.label="Fenster/Tür Sensor",this._els.windowPicker.selector={entity:{domain:["binary_sensor"],device_class:["window","door","opening"]}},this._els.climatePicker.label="Thermostat (Climate)",this._els.climatePicker.selector={entity:{domain:["climate"]}},this._els.name.addEventListener("input",(e=>this._updateConfig("name",e.target.value))),this._els.icon.addEventListener("value-changed",(e=>this._updateConfig("icon",e.detail.value))),this._els.navPath.addEventListener("input",(e=>this._updateConfig("nav_path",e.target.value))),this._els.btnSlotsMinus.addEventListener("click",(()=>{let e=n(this._config.max_buttons||4,1,4);e>1&&(this._updateConfig("max_buttons",e-1),this._syncForm())})),this._els.btnSlotsPlus.addEventListener("click",(()=>{let e=n(this._config.max_buttons||4,1,4);e<4&&(this._updateConfig("max_buttons",e+1),this._syncForm())})),this._els.tempPicker.addEventListener("value-changed",(e=>this._updateConfig("temp_entity",e.detail.value))),t.querySelector("#clearTemp").addEventListener("click",(()=>{this._updateConfig("temp_entity",""),this._syncForm()})),this._els.humidityPicker.addEventListener("value-changed",(e=>this._updateConfig("humidity_entity",e.detail.value))),t.querySelector("#clearHumidity").addEventListener("click",(()=>{this._updateConfig("humidity_entity",""),this._syncForm()})),this._els.windowPicker.addEventListener("value-changed",(e=>this._updateConfig("window_entity",e.detail.value))),t.querySelector("#clearWindow").addEventListener("click",(()=>{this._updateConfig("window_entity",""),this._syncForm()})),this._els.climatePicker.addEventListener("value-changed",(e=>this._updateConfig("climate_entity",e.detail.value))),t.querySelector("#clearClimate").addEventListener("click",(()=>{this._updateConfig("climate_entity",""),this._syncForm()})),this._els.showDoorClosed.addEventListener("change",(e=>this._updateConfig("show_door_closed",e.target.checked))),this._els.darkText.addEventListener("change",(e=>this._updateConfig("dark_text",e.target.checked))),this._els.invert.addEventListener("change",(e=>this._updateConfig("cover_invert",e.target.checked))),this._els.colorOn.addEventListener("input",(e=>this._updateConfig("color_on",e.target.value))),t.querySelector("#clearColorOn").addEventListener("click",(()=>{this._updateConfig("color_on",""),this._syncForm()})),this._els.colorOnDark.addEventListener("input",(e=>this._updateConfig("color_on_dark",e.target.value))),t.querySelector("#clearColorOnDark").addEventListener("click",(()=>{this._updateConfig("color_on_dark",""),this._syncForm()})),this._els.colorCover.addEventListener("input",(e=>this._updateConfig("color_cover",e.target.value))),t.querySelector("#clearColorCover").addEventListener("click",(()=>{this._updateConfig("color_cover",""),this._syncForm()})),this._els.colorCoverDark.addEventListener("input",(e=>this._updateConfig("color_cover_dark",e.target.value))),t.querySelector("#clearColorCoverDark").addEventListener("click",(()=>{this._updateConfig("color_cover_dark",""),this._syncForm()})),this._els.colorDoorOpen.addEventListener("input",(e=>this._updateConfig("color_door_open",e.target.value))),t.querySelector("#clearColorDoorOpen").addEventListener("click",(()=>{this._updateConfig("color_door_open",""),this._syncForm()})),this._els.colorDoorOpenDark.addEventListener("input",(e=>this._updateConfig("color_door_open_dark",e.target.value))),t.querySelector("#clearColorDoorOpenDark").addEventListener("click",(()=>{this._updateConfig("color_door_open_dark",""),this._syncForm()})),this._els.colorDoorClosed.addEventListener("input",(e=>this._updateConfig("color_door_closed",e.target.value))),t.querySelector("#clearColorDoorClosed").addEventListener("click",(()=>{this._updateConfig("color_door_closed",""),this._syncForm()})),this._els.colorDoorClosedDark.addEventListener("input",(e=>this._updateConfig("color_door_closed_dark",e.target.value))),t.querySelector("#clearColorDoorClosedDark").addEventListener("click",(()=>{this._updateConfig("color_door_closed_dark",""),this._syncForm()})),this._els.addBtn.addEventListener("click",(()=>{this._config.buttons.push({entity:"",icon:"",type:"entity"}),this._syncButtonListDOM(),this._emitDebounced()}))}_updateConfig(e,t){this._config[e]!==t&&(this._config[e]=t,this._emitDebounced())}_syncForm(){if(!this._config||!this._built)return;this._els.name.value!==(this._config.name||"")&&(this._els.name.value=this._config.name||""),this._els.icon.value!==(this._config.icon||"mdi:home")&&(this._els.icon.value=this._config.icon||"mdi:home"),this._els.navPath.value!==(this._config.nav_path||"")&&(this._els.navPath.value=this._config.nav_path||"");const e=n(this._config.max_buttons??4,1,4);this._els.slotsValue.textContent!==String(e)&&(this._els.slotsValue.textContent=String(e)),this._els.tempPicker.value!==(this._config.temp_entity||"")&&(this._els.tempPicker.value=this._config.temp_entity||""),this._els.humidityPicker.value!==(this._config.humidity_entity||"")&&(this._els.humidityPicker.value=this._config.humidity_entity||""),this._els.windowPicker.value!==(this._config.window_entity||"")&&(this._els.windowPicker.value=this._config.window_entity||""),this._els.climatePicker.value!==(this._config.climate_entity||"")&&(this._els.climatePicker.value=this._config.climate_entity||""),this._els.showDoorClosed.checked!==!!this._config.show_door_closed&&(this._els.showDoorClosed.checked=!!this._config.show_door_closed),this._els.darkText.checked!==!!this._config.dark_text&&(this._els.darkText.checked=!!this._config.dark_text),this._els.invert.checked!==!!this._config.cover_invert&&(this._els.invert.checked=!!this._config.cover_invert),this._els.colorOn.value!==(this._config.color_on||"")&&(this._els.colorOn.value=this._config.color_on||""),this._els.colorOnDark.value!==(this._config.color_on_dark||"")&&(this._els.colorOnDark.value=this._config.color_on_dark||""),this._els.colorCover.value!==(this._config.color_cover||"")&&(this._els.colorCover.value=this._config.color_cover||""),this._els.colorCoverDark.value!==(this._config.color_cover_dark||"")&&(this._els.colorCoverDark.value=this._config.color_cover_dark||""),this._els.colorDoorOpen.value!==(this._config.color_door_open||"")&&(this._els.colorDoorOpen.value=this._config.color_door_open||""),this._els.colorDoorOpenDark.value!==(this._config.color_door_open_dark||"")&&(this._els.colorDoorOpenDark.value=this._config.color_door_open_dark||""),this._els.colorDoorClosed.value!==(this._config.color_door_closed||"")&&(this._els.colorDoorClosed.value=this._config.color_door_closed||""),this._els.colorDoorClosedDark.value!==(this._config.color_door_closed_dark||"")&&(this._els.colorDoorClosedDark.value=this._config.color_door_closed_dark||""),this._syncButtonListDOM()}_syncButtonListDOM(){const e=this._config.buttons||[],t=this._els.buttonsWrap;for(;t.children.length>e.length;)t.removeChild(t.lastChild),this._buttonElements.pop();for(;t.children.length<e.length;)t.appendChild(this._createEditorRow());e.forEach(((e,i)=>{const n=t.children[i];n.dataset.idx=String(i);const o=this._buttonElements[i];o.entity.label=`Entität (Slot ${i+1})`,o.entity.value!==(e.entity||"")&&(o.entity.value=e.entity||""),o.icon.value!==(e.icon||"")&&(o.icon.value=e.icon||"");const s=n.querySelector(".delete-icon");i<1?s.classList.add("disabled"):s.classList.remove("disabled")}))}_createEditorRow(){const e=document.createElement("div");e.className="list-item",e.draggable=!0,e.innerHTML='\n        <div class="handle" title="Ziehen zum Sortieren"><ha-icon icon="mdi:drag"></ha-icon></div>\n        <div class="item-content"><div class="entity-wrap"></div><div class="icon-wrap"></div></div>\n        <div class="icon-btn delete-icon" title="Gerät entfernen"><ha-icon icon="mdi:delete-outline"></ha-icon></div>\n      ';const t=e.querySelector(".entity-wrap"),i=e.querySelector(".icon-wrap"),n=e.querySelector(".delete-icon"),o=e.querySelector(".handle"),s=document.createElement("ha-selector");s.hass=this._hass,s.selector={entity:{}};const a=document.createElement("div");a.className="icon-btn",a.style.cssText="cursor:pointer; padding:4px; display:flex; align-items:center; margin-top: 25px;",a.innerHTML='<ha-icon icon="mdi:close"></ha-icon>',a.title="Feld leeren";const l=document.createElement("ha-icon-picker");l.label="Icon (Optional)";const c=()=>parseInt(e.dataset.idx,10);a.addEventListener("click",(e=>{e.stopPropagation(),this._config.buttons[c()].entity="",this._emitDebounced(),this._syncForm()})),s.addEventListener("value-changed",(e=>{e.stopPropagation();const t=c(),i=(e.detail.value||"").trim();this._config.buttons[t].entity!==i&&(this._config.buttons[t].entity=i,!this._config.buttons[t].icon&&i&&(this._config.buttons[t].icon=r(i)),this._emitDebounced(),this._syncForm())})),l.addEventListener("value-changed",(e=>{e.stopPropagation();const t=c(),i=(e.detail.value||"").trim();this._config.buttons[t].icon!==i&&(this._config.buttons[t].icon=i,this._emitDebounced())})),n.addEventListener("click",(()=>{const e=c();e<1||(this._config.buttons.splice(e,1),this._syncButtonListDOM(),this._emitDebounced())})),e.addEventListener("dragstart",(t=>{t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.dataset.idx),setTimeout((()=>e.classList.add("dragging")),0)})),e.addEventListener("dragend",(()=>{e.classList.remove("dragging"),this._els.buttonsWrap.querySelectorAll(".drag-over").forEach((e=>e.classList.remove("drag-over")))})),e.addEventListener("dragover",(t=>{t.preventDefault(),t.dataTransfer.dropEffect="move",e.classList.add("drag-over")})),e.addEventListener("dragleave",(()=>{e.classList.remove("drag-over")})),e.addEventListener("drop",(t=>{t.preventDefault(),e.classList.remove("drag-over");const i=parseInt(t.dataTransfer.getData("text/plain"),10),n=c();if(!isNaN(i)&&i!==n){const[e]=this._config.buttons.splice(i,1);this._config.buttons.splice(n,0,e);const t=this._els.buttonsWrap,o=t.children[i];i<n?t.insertBefore(o,t.children[n].nextSibling):t.insertBefore(o,t.children[n]);const[s]=this._buttonElements.splice(i,1);this._buttonElements.splice(n,0,s),Array.from(t.children).forEach(((e,t)=>{e.dataset.idx=String(t),this._buttonElements[t].entity.label=`Entität (Slot ${t+1})`})),this._emitDebounced()}}));let d=null;return o.addEventListener("touchstart",(t=>{t.stopPropagation(),d=e,e.classList.add("dragging")}),{passive:!0}),o.addEventListener("touchmove",(e=>{if(!d)return;e.preventDefault();const t=e.touches[0],i=this.shadowRoot.elementsFromPoint(t.clientX,t.clientY).find((e=>e&&e.classList&&e.classList.contains("list-item")));this._els.buttonsWrap.querySelectorAll(".drag-over").forEach((e=>e.classList.remove("drag-over"))),i&&i!==d&&i.classList.add("drag-over")}),{passive:!1}),o.addEventListener("touchend",(e=>{if(!d)return;e.stopPropagation(),d.classList.remove("dragging");const t=e.changedTouches[0],i=this.shadowRoot.elementsFromPoint(t.clientX,t.clientY).find((e=>e&&e.classList&&e.classList.contains("list-item")));if(this._els.buttonsWrap.querySelectorAll(".drag-over").forEach((e=>e.classList.remove("drag-over"))),i&&i!==d){const e=parseInt(d.dataset.idx,10),t=parseInt(i.dataset.idx,10);if(!isNaN(e)&&!isNaN(t)&&e!==t){const[i]=this._config.buttons.splice(e,1);this._config.buttons.splice(t,0,i);const n=this._els.buttonsWrap;e<t?n.insertBefore(d,n.children[t].nextSibling):n.insertBefore(d,n.children[t]);const[o]=this._buttonElements.splice(e,1);this._buttonElements.splice(t,0,o),Array.from(n.children).forEach(((e,t)=>{e.dataset.idx=String(t),this._buttonElements[t].entity.label=`Entität (Slot ${t+1})`})),this._emitDebounced()}}d=null})),t.appendChild(s),t.appendChild(a),i.appendChild(l),this._buttonElements.push({entity:s,icon:l}),e}_emitDebounced(){this._emitTimer&&clearTimeout(this._emitTimer),this._emitTimer=setTimeout((()=>{const t={type:`custom:${e}`,name:(this._config.name??"").trim(),icon:(this._config.icon??"mdi:home").trim(),temp_entity:(this._config.temp_entity??"").trim(),humidity_entity:(this._config.humidity_entity??"").trim(),window_entity:(this._config.window_entity??"").trim(),climate_entity:(this._config.climate_entity??"").trim(),nav_path:(this._config.nav_path??"").trim(),cover_invert:!!this._config.cover_invert,dark_text:!!this._config.dark_text,show_door_closed:!!this._config.show_door_closed,color_on:(this._config.color_on??"").trim(),color_on_dark:(this._config.color_on_dark??"").trim(),color_cover:(this._config.color_cover??"").trim(),color_cover_dark:(this._config.color_cover_dark??"").trim(),color_door_open:(this._config.color_door_open??"").trim(),color_door_open_dark:(this._config.color_door_open_dark??"").trim(),color_door_closed:(this._config.color_door_closed??"").trim(),color_door_closed_dark:(this._config.color_door_closed_dark??"").trim(),max_buttons:n(this._config.max_buttons??4,1,4),buttons:(this._config.buttons||[]).map((e=>{const t={...e};return delete t._service_data_json,t.icon||delete t.icon,t.nav_path||delete t.nav_path,t.service||delete t.service,t.service_data||delete t.service_data,t}))};a(this,"config-changed",{config:t})}),100)}}customElements.get(e)||customElements.define(e,d),customElements.get(t)||customElements.define(t,p),window.customCards=window.customCards||[],window.customCards.some((t=>t.type===e))||window.customCards.push({type:e,name:"Smarvy Area Card",description:"Premium Area card with Glassmorphism, Pop-up and Progress Veil."})})();
